<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Areis"><meta name="keywords" content="北辰代码海游记"><meta name="description" content="学习 spring 有一段时间了，期间没有时间练习，现在学一下 spring5，再开始做项目"><meta property="og:type" content="article"><meta property="og:title" content="Spring5"><meta property="og:url" content="https://polarisink.github.io/20220813/yuque/Spring5/index.html"><meta property="og:site_name" content="北辰代码海游记"><meta property="og:description" content="学习 spring 有一段时间了，期间没有时间练习，现在学一下 spring5，再开始做项目"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://images.unsplash.com/photo-1664821661295-b63459d963fc?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDIwfHJuU0tESHd3WVVrfHxlbnwwfHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60"><meta property="article:published_time" content="2022-08-13T13:39:40.000Z"><meta property="article:modified_time" content="2023-09-22T09:48:26.962Z"><meta property="article:author" content="Areis"><meta property="article:tag" content="北辰代码海游记"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://images.unsplash.com/photo-1664821661295-b63459d963fc?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHx0b3BpYy1mZWVkfDIwfHJuU0tESHd3WVVrfHxlbnwwfHx8fA%3D%3D&auto=format&fit=crop&w=500&q=60"><meta name="referrer" content="no-referrer-when-downgrade"><title>Spring5 - 北辰代码海游记</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"polarisink.github.io",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:"def4041fb780cef0cc140bf25b8cb569",google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>北辰代码海游记</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item"><a class="nav-link" href="/links/"><i class="iconfont icon-link-fill"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://aries-blog.oss-cn-hangzhou.aliyuncs.com/beauty.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="Spring5"></span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Areis </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2022-08-13 21:39" pubdate>2022年8月13日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 35k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 296 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">Spring5</h1><div class="markdown-body"><p>学习 spring 有一段时间了，期间没有时间练习，现在学一下 spring5，再开始做项目</p><span id="more"></span><h1 id="一、引言"><a href="#一、引言" class="headerlink" title="一、引言"></a>一、引言</h1><h2 id="1、EJB-存在的问题"><a href="#1、EJB-存在的问题" class="headerlink" title="1、EJB 存在的问题"></a>1、EJB 存在的问题</h2><ul><li>是一个重量级框架</li><li>运行环境苛刻</li><li>代码移植性差</li></ul><h2 id="2、什么是-Spring"><a href="#2、什么是-Spring" class="headerlink" title="2、什么是 Spring"></a>2、什么是 Spring</h2><blockquote><p>是一个轻量级的 JavaEE 解决方案，整合众多优秀的设计模式</p></blockquote><ul><li>轻量级</li></ul><blockquote><p>对运行环境没有额外要求</p><p>代码移植性高，不需要实现额外的借口</p></blockquote><ul><li>JavaEE 解决方案</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FqmpecrjSjjYjE7jtH9scQYxSSuI.png" srcset="/img/loading.gif" lazyload></p><h2 id="3、设计模式"><a href="#3、设计模式" class="headerlink" title="3、设计模式"></a>3、设计模式</h2><blockquote><p>广义：面向对象设计中，解决特定问题的经典代码</p><p>狭义：GOF4 人帮定义的 23 种设计模式：工厂、适配器、门面、代理、模板</p></blockquote><h3 id="1、工厂模式"><a href="#1、工厂模式" class="headerlink" title="1、工厂模式"></a>1、工厂模式</h3><h4 id="什么是工厂模式"><a href="#什么是工厂模式" class="headerlink" title="什么是工厂模式"></a>什么是工厂模式</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 概念；通过工厂类创建对象<br>   User user = new user();<br><span class="hljs-bullet">2.</span> 好处：解耦合<br></code></pre></td></tr></table></figure><h4 id="简单工厂的实现"><a href="#简单工厂的实现" class="headerlink" title="简单工厂的实现"></a>简单工厂的实现</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BeanFactory</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Properties</span> <span class="hljs-variable">env</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>    <span class="hljs-comment">//资源加载用static</span><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-comment">//获取io输入流</span><br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> BeanFactory.class.getResourceAsStream(<span class="hljs-string">&quot;.properties&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//文件内容</span><br>            env.load(inputStream);<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span>(inputStream != <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                    e.printStackTrace();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 对象创建：</span><br><span class="hljs-comment">     * 1、直接调用构造方法new</span><br><span class="hljs-comment">     * 2、反射创建：获取类字节码对象，字节码对象反射创建</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> UserService <span class="hljs-title function_">getUserService</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(env.getProperty(<span class="hljs-string">&quot;userService&quot;</span>));<br>            userService = (UserService) clazz.newInstance();<br>        &#125;<span class="hljs-keyword">catch</span> (ClassNotFoundException e)&#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">catch</span> (InstantiationException e)&#123;<br>            e.printStackTrace();<br>        &#125;<span class="hljs-keyword">catch</span> (IllegalAccessException e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> userService;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="通用工厂的设计"><a href="#通用工厂的设计" class="headerlink" title="通用工厂的设计"></a>通用工厂的设计</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//代码冗余，写一个工厂类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Object <span class="hljs-title function_">getBean</span><span class="hljs-params">(String key)</span>&#123;<br>  <span class="hljs-type">Object</span> <span class="hljs-variable">obj</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>  <span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(env.getProperty(key));<br>    obj = clazz.newInstance();<br>  &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>    e.printStackTrace();<br>  &#125; <span class="hljs-keyword">catch</span> (Exception e)&#123;<br>    e.printStackTrace();<br>  &#125;<br>  <span class="hljs-keyword">return</span> obj;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="通用工厂的使用方式"><a href="#通用工厂的使用方式" class="headerlink" title="通用工厂的使用方式"></a>通用工厂的使用方式</h4><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 定义类型（类）<br><span class="hljs-bullet">2.</span> 通过配置文件的配置告知工厂（applicationContext.properties）<br><span class="hljs-bullet">3.</span> 通过工厂获得类的对象<br>   Object obj = BeanFactory.getBean(&quot;key&quot;)<br></code></pre></td></tr></table></figure><h1 id="二、第一个-Spring-程序"><a href="#二、第一个-Spring-程序" class="headerlink" title="二、第一个 Spring 程序"></a>二、第一个 Spring 程序</h1><h2 id="1、软件版本"><a href="#1、软件版本" class="headerlink" title="1、软件版本"></a>1、软件版本</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">1.JDK1.8+<br>2.maven3.5+<br>3.IDEA2018+<br>4.SpringFramework5<br></code></pre></td></tr></table></figure><h2 id="2、环境搭建"><a href="#2、环境搭建" class="headerlink" title="2、环境搭建"></a>2、环境搭建</h2><ul><li>Spring 的 jar 包</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-context --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-context<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.4.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>Spring 配置文件</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 配置文件放置没有特殊要求<br><span class="hljs-bullet">2.</span> 命名：建议 applicationContext.xml<br><span class="hljs-bullet">3.</span> 以后应用 spring 框架，需要进行配置文件路径的设置<br></code></pre></td></tr></table></figure><h2 id="3、Spring-核心-API"><a href="#3、Spring-核心-API" class="headerlink" title="3、Spring 核心 API"></a>3、Spring 核心 API</h2><ul><li>ApplicationContext</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown">作用：Spring 提供的 applicationcontext 这个工厂，用于对象的创建<br>好处：解耦合<br></code></pre></td></tr></table></figure><ul><li>ApplcationContext 接口类型</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">接口：屏蔽实现的差异<br>非 web 环境：ClassPathXmlApplicationContext<br>web 环境：XmlWebApplicationContext<br></code></pre></td></tr></table></figure><ul><li>重量级资源</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">ApplicationContext 工厂的实现类会占用大量内存<br>不会频繁创建对象，一个应用之创建一个工厂对象<br>ApplicationContext 工厂；一定是线程安全的（多线程并发访问）<br></code></pre></td></tr></table></figure><h2 id="4、程序开发"><a href="#4、程序开发" class="headerlink" title="4、程序开发"></a>4、程序开发</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 创建类型<br><span class="hljs-bullet">2.</span> 配置文件配置<br>   <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.basic.Person&quot;</span>&gt;</span></span><span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="hljs-bullet">3.</span> 通过工厂获得对象<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test2</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-comment">//获得工厂</span><br>  <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ac</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathXmlApplicationContext</span>(<span class="hljs-string">&quot;/applicationContext.xml&quot;</span>);<br>  <span class="hljs-comment">//通过工厂类获得对象:传入字节码之后不需要强转</span><br>  <span class="hljs-type">Person</span> <span class="hljs-variable">person</span> <span class="hljs-operator">=</span> ac.getBean(<span class="hljs-string">&quot;person&quot;</span>,Person.class);<br>  System.out.println(person);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="5、细节"><a href="#5、细节" class="headerlink" title="5、细节"></a>5、细节</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs markdown">1、 2. 只配置 class 属性，不配置 id 值<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.basic.Person&quot;</span>/&gt;</span></span><br>应用场景：只需要使用一次，可以省略 id 值 3. name 属性，bean 对象的别名<br>作用：用于在 Spirng 的配置文件，为 bean 对象定义别名<br>相同：<br>1、ctx.getBean(id | name) -- &gt; object<br>2、<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></span><br>等效<br><span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></span><br>区别：<br>1、别名可以定义多个，id 只能定义一个<br>2、xml 的 id 属性命名要求：以字母开头，数字字母下划线连字符<br>name 属性命名没有要求<br>name 属性特殊应用：/person（spring+struct1）<br>3、代码<br>//判断是否存在指定 id 值的 bean，不能判断 name 值<br>ac.containsBeanDefinition(&quot;person&quot;)<br>//判断是否存在指定 id 值的 bean，也可以判断 name 值<br>ac.containsBean(&quot;person&quot;)<br></code></pre></td></tr></table></figure><h2 id="6、Spring-工厂的底层实现原理（简易版）"><a href="#6、Spring-工厂的底层实现原理（简易版）" class="headerlink" title="6、Spring 工厂的底层实现原理（简易版）"></a>6、Spring 工厂的底层实现原理（简易版）</h2><h2 id="7、思考"><a href="#7、思考" class="headerlink" title="7、思考"></a>7、思考</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 是不是所有对象都会交给 spring 创建呢<br>   答：理论上是的，单有特例，实体对象除开（由吃韭菜框架进行创建）<br></code></pre></td></tr></table></figure><h1 id="三、Spring5-x-与日志框架整合"><a href="#三、Spring5-x-与日志框架整合" class="headerlink" title="三、Spring5.x 与日志框架整合"></a>三、Spring5.x 与日志框架整合</h1><blockquote><p>spring 与日志框架进行整合，日志框架就可以在控制台中，输出 spring 框架运行时的重要消息</p></blockquote><ul><li>spring 如何整合日志框架</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">spring5.默认整合 logback、log4j2<br></code></pre></td></tr></table></figure><ul><li>pom</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.slf4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>slf4j-log4j12<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.7.25<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>log4j<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.17<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>Log4j.properties</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment"># 配置根</span><br><span class="hljs-attr">log4j.rootLogger</span> = <span class="hljs-string">debug.console</span><br><span class="hljs-comment"># 日志输出到控制台显示</span><br><span class="hljs-attr">log4j.appender.console</span>=<span class="hljs-string">org.apache.log4j.ConsoleAppender</span><br><span class="hljs-attr">log4j.appender.console.Target</span>=<span class="hljs-string">System.out</span><br><span class="hljs-attr">log4j.appender.layout</span>=<span class="hljs-string">org.apache.log4j.PatternLayout</span><br><span class="hljs-attr">log4j.appender.ConversionPattern</span>=<span class="hljs-string">%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p %c&#123;1&#125;:%L - %m%n</span><br></code></pre></td></tr></table></figure><h1 id="四、注入（Injection）"><a href="#四、注入（Injection）" class="headerlink" title="四、注入（Injection）"></a>四、注入（Injection）</h1><h2 id="1、什么是注入"><a href="#1、什么是注入" class="headerlink" title="1、什么是注入"></a>1、什么是注入</h2><h3 id="1、为什么需要注入"><a href="#1、为什么需要注入" class="headerlink" title="1、为什么需要注入"></a>1、为什么需要注入</h3><blockquote><p>通过编码的方式会存在耦合</p><p>person.setName(“lqs”);</p></blockquote><h3 id="2、如何注入"><a href="#2、如何注入" class="headerlink" title="2、如何注入"></a>2、如何注入</h3><ul><li>类成员变量提供 set 方法</li><li>spring 配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.basic.Person&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3、好处"><a href="#3、好处" class="headerlink" title="3、好处"></a>3、好处</h3><ul><li>解耦合</li></ul><h2 id="2、Spring-注入的原理分析"><a href="#2、Spring-注入的原理分析" class="headerlink" title="2、Spring 注入的原理分析"></a>2、Spring 注入的原理分析</h2><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-number">1</span>. &lt;bean class<span class="hljs-operator">=</span><span class="hljs-string">&quot;com.lqs.basic.Person&quot;</span>&gt; <span class="hljs-operator">=</span><span class="hljs-operator">=</span> Person p <span class="hljs-operator">=</span> new Person()<span class="hljs-comment">;</span><br><span class="hljs-number">2</span>. &lt;property name<span class="hljs-operator">=</span><span class="hljs-string">&quot;id&quot;</span> value<span class="hljs-operator">=</span><span class="hljs-string">&quot;lqs&quot;</span>&gt; <span class="hljs-operator">=</span><span class="hljs-operator">=</span> p.setName(<span class="hljs-string">&quot;lqs&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="3、Set-注入"><a href="#3、Set-注入" class="headerlink" title="3、Set 注入"></a>3、Set 注入</h2><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FoLceTlvgauXtEIjvX6zVBS9qlw2.png" srcset="/img/loading.gif" lazyload></p><h3 id="1、JDK-内置类型"><a href="#1、JDK-内置类型" class="headerlink" title="1、JDK 内置类型"></a>1、JDK 内置类型</h3><h4 id="String-8-种基本类型"><a href="#String-8-种基本类型" class="headerlink" title="String+8 种基本类型"></a>String+8 种基本类型</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>suns<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>ccc<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>ccc<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>aa<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>ccc<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- key和value都可为自定义类型，使用ref--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">map</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;testA&quot;</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>lqs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;testB&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>bbb<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>lqs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">map</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">props</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;testC&quot;</span>&gt;</span>ccc<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">prop</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;testD&quot;</span>&gt;</span>ddd<span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">prop</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">prop</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">props</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2、自定义类型"><a href="#2、自定义类型" class="headerlink" title="2、自定义类型"></a>2、自定义类型</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--方式一：代码冗余，会创建多余bean，浪费内存资源--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserServiceImpl&quot;</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">property</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserDaoImpl&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--方式二：直接ref，不会创建多余对象，建议使用--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserDaoImpl&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>lqs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserService&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3、Set-注入的简化写法"><a href="#3、Set-注入的简化写法" class="headerlink" title="3、Set 注入的简化写法"></a>3、Set 注入的简化写法</h3><h4 id="基于属性简化"><a href="#基于属性简化" class="headerlink" title="基于属性简化"></a>基于属性简化</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs xml">JDK类型注入<br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userDao&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserDaoImpl&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;lqs&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br>  替换下面的写法，只能简化8种基本类型和String<br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>lqs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br>用户自定义类型<br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserDaoImpl&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br>  替换下面的写法<br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;userDao&quot;</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h4 id="基于命名空间-p-简化"><a href="#基于命名空间-p-简化" class="headerlink" title="基于命名空间 p 简化"></a>基于命名空间 p 简化</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml">用p标签代替property<br>用于8种基本类型和String<br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.Person&quot;</span> <span class="hljs-attr">p:name</span>=<span class="hljs-string">&quot;lqs&quot;</span><span class="hljs-attr">p:id</span>=<span class="hljs-string">&quot;100&quot;</span>/&gt;</span><br>用于自定义类型<br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.UserService&quot;</span> <span class="hljs-attr">p-userDao-ref</span>=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h2 id="4、构造注入"><a href="#4、构造注入" class="headerlink" title="4、构造注入"></a>4、构造注入</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">构造注入：Spring调用构造方法，通过配置文件为成员变量复制<br></code></pre></td></tr></table></figure><h3 id="1、使用方法"><a href="#1、使用方法" class="headerlink" title="1、使用方法"></a>1、使用方法</h3><ul><li>提供有参构造方法</li><li>配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.Person&quot;</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">constructor-org</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>18<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-org</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">constructor-org</span>&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">value</span>&gt;</span>lqs<span class="hljs-tag">&lt;/<span class="hljs-name">value</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">constructor-org</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="2、构造方法重载"><a href="#2、构造方法重载" class="headerlink" title="2、构造方法重载"></a>2、构造方法重载</h3><h4 id="1、参数个数不同时"><a href="#1、参数个数不同时" class="headerlink" title="1、参数个数不同时"></a>1、参数个数不同时</h4><ul><li>通过的数量来区分</li></ul><h4 id="2、参数个数相同时"><a href="#2、参数个数相同时" class="headerlink" title="2、参数个数相同时"></a>2、参数个数相同时</h4><ul><li>在标签引入 type 属性对区分</li></ul><h2 id="5、注入的总结"><a href="#5、注入的总结" class="headerlink" title="5、注入的总结"></a>5、注入的总结</h2><blockquote><p>实战中使用 set 注入还是 get 注入？</p><p>答：set 注入更多</p><p>1、构造注入更麻烦</p><p>2、Spring 使用 set 注入更多</p></blockquote><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FtA4mf6Uv-cvPytH0vdLheH2uhai.png" srcset="/img/loading.gif" lazyload></p><h1 id="五、控制反转与依赖注入"><a href="#五、控制反转与依赖注入" class="headerlink" title="五、控制反转与依赖注入"></a>五、控制反转与依赖注入</h1><h2 id="1、控制反转（Inverse-of-Control）"><a href="#1、控制反转（Inverse-of-Control）" class="headerlink" title="1、控制反转（Inverse of Control）"></a>1、控制反转（Inverse of Control）</h2><blockquote><p>对成员变量赋值的控制权发生变化：</p><p>从代码 —&gt; spring 工厂和配置文件</p><p>解耦合</p></blockquote><h2 id="2、依赖注入"><a href="#2、依赖注入" class="headerlink" title="2、依赖注入"></a>2、依赖注入</h2><blockquote><p>注入：通过 spring 工厂及配置文件，为对象成员变量赋值</p><p>依赖注入：当一个类需要另一个类时，就发生依赖，一旦出现以来，就把另一个类作为本类的成员变量，通过 Spring 注入</p></blockquote><h1 id="六、Spring-工厂创建复杂对象"><a href="#六、Spring-工厂创建复杂对象" class="headerlink" title="六、Spring 工厂创建复杂对象"></a>六、Spring 工厂创建复杂对象</h1><blockquote><p>简单对象：可以直接 new 创建的对象</p><p>复杂对象：不能通过 new 创建的，如 Connection、SqlSessionFactory</p></blockquote><h2 id="1、创建复杂对象的-3-种方式"><a href="#1、创建复杂对象的-3-种方式" class="headerlink" title="1、创建复杂对象的 3 种方式"></a>1、创建复杂对象的 3 种方式</h2><h3 id="1、Factory-接口"><a href="#1、Factory-接口" class="headerlink" title="1、Factory 接口"></a>1、Factory 接口</h3><ul><li>实现 Factory 接口</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//泛型：在此处为Connection</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionFactory</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;Connection&gt; &#123;<br>  <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">con</span> <span class="hljs-operator">=</span> DriverManager.getConnection(url,username,password);<br>    <span class="hljs-keyword">return</span> con;<br>  &#125;<br>  <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType() &#123;<br>    <span class="hljs-keyword">return</span> Connection.class;<br>  &#125;<br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>Spring 配置文件的配置</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 当Class指定的是FactoryBean接口的实现类，那么通过id值获得的是这个类创建的是复杂对象con<br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;con&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.ConnectionFactorybean&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>细节<ul><li>如果想得到 BeanFactory 的实现类</li></ul></li></ul><p>&#x2F;&#x2F;加一个&amp;获得<br>ac.getBean(“&amp;con”)</p><figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>- isSingleton方法<br><br>```xml<br>根据对象特点决定是否为单例，连接对象每次都应该创建新的<br></code></pre></td></tr></table></figure><ul><li>FactoryBean 实现原理</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs markdown">接口回调<br><br><span class="hljs-bullet">1.</span> 为什么 Spring 规定 FactoryBean 接口并实现 getObject()<br><span class="hljs-bullet">2.</span> ac.getBean(&quot;con&quot;)获得的是复杂对象 Connection 而不是 ConnectionFactoryBean(&amp;)<br><br>Spring 内部运行流程<br><br><span class="hljs-bullet">1.</span> 通过 con 获得 ConnectionFactoryBean 类的对象，今儿通过 instance 判断出是 FactoryBean 的实现类<br><span class="hljs-bullet">2.</span> 按照规定 getobject() --&gt; Connection<br><span class="hljs-bullet">3.</span> 返回 Object<br></code></pre></td></tr></table></figure><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FshzSTgpyt4tQOJY3Cs6n27szRKO.png" srcset="/img/loading.gif" lazyload></p><ul><li>FactoryBean 总结</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">Spring 用于创建复杂对象的一种方式，也是 Spring 原生提供的，后续讲解 Spring 整合其他框架会大量应用 FactoryBean<br></code></pre></td></tr></table></figure><h3 id="2、实例工厂"><a href="#2、实例工厂" class="headerlink" title="2、实例工厂"></a>2、实例工厂</h3><blockquote><p>避免 Spring 框架的侵入</p><p>整合遗留系统</p></blockquote><ul><li>编写 Java 类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionFactory</span>&#123;<br>  <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">con</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>      con = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/spring5&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;lxl20000413&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>      e.printStackTrace();<br>    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>      e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> con;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>编写配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;connectionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.basic.ConnectionFactory&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;con&quot;</span> <span class="hljs-attr">factory-bean</span>=<span class="hljs-string">&quot;connectionFactory&quot;</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;getConnection&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3、静态工厂"><a href="#3、静态工厂" class="headerlink" title="3、静态工厂"></a>3、静态工厂</h3><ul><li>编写 Java 类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StaticConnectionFactory</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Connection <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">con</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      Class.forName(<span class="hljs-string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);<br>      con = DriverManager.getConnection(<span class="hljs-string">&quot;jdbc:mysql://localhost:3306/spring5&quot;</span>,<span class="hljs-string">&quot;root&quot;</span>,<span class="hljs-string">&quot;lxl20000413&quot;</span>);<br>    &#125; <span class="hljs-keyword">catch</span> (SQLException e) &#123;<br>      e.printStackTrace();<br>    &#125; <span class="hljs-keyword">catch</span> (ClassNotFoundException e) &#123;<br>      e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> con;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;con&quot;</span><span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.basic.StaticConnectionFactory&quot;</span> <span class="hljs-attr">factory-method</span>=<span class="hljs-string">&quot;getConnection&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2、Spring-工厂模式总结"><a href="#2、Spring-工厂模式总结" class="headerlink" title="2、Spring 工厂模式总结"></a>2、Spring 工厂模式总结</h2><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FnVg0Jm2n8OHTOs6YAyie8W3Y2XJ.png" srcset="/img/loading.gif" lazyload></p><h1 id="七、控制-Spring-工厂创建对象的次数"><a href="#七、控制-Spring-工厂创建对象的次数" class="headerlink" title="七、控制 Spring 工厂创建对象的次数"></a>七、控制 Spring 工厂创建对象的次数</h1><h2 id="1、简单对象的创建次数"><a href="#1、简单对象的创建次数" class="headerlink" title="1、简单对象的创建次数"></a>1、简单对象的创建次数</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;person&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.Person&quot;</span> <span class="hljs-attr">scope</span>=<span class="hljs-string">&quot;singleton&quot;</span>/&gt;</span><br>singleton:默认值，单例模式<br>prototype:多例模式<br>request:在一次http请求中，每个bean对应一个实例，基于web<br>session:在一个http session中，每个bean对应一个实例，基于web<br>global session:在一个全局http session中，每个bean对应一个实例，在Portlet上下文有意义<br></code></pre></td></tr></table></figure><h2 id="2、复杂对象创建次数"><a href="#2、复杂对象创建次数" class="headerlink" title="2、复杂对象创建次数"></a>2、复杂对象创建次数</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">FactoryBean&#123;<br>  isSingleton()&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>/<span class="hljs-literal">true</span>;多例/单例<br>  &#125;<br>&#125;<br><span class="hljs-comment">//没有isSingleton时，通过scope属性进行控制</span><br></code></pre></td></tr></table></figure><h2 id="3、为什么控制对象创建次数"><a href="#3、为什么控制对象创建次数" class="headerlink" title="3、为什么控制对象创建次数"></a>3、为什么控制对象创建次数</h2><blockquote><p>节省不必要的内存浪费</p></blockquote><ul><li>什么样的对象单例<ul><li>SqlSessionFactory</li><li>Dao</li><li>Service</li></ul></li><li>什么样的对象多例<ul><li>Connection</li><li>SqlSession</li></ul></li></ul><h1 id="八、生命周期"><a href="#八、生命周期" class="headerlink" title="八、生命周期"></a>八、生命周期</h1><blockquote><p>对象创建、存活、消亡的完整过程</p></blockquote><h2 id="1、创建阶段"><a href="#1、创建阶段" class="headerlink" title="1、创建阶段"></a>1、创建阶段</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">singleton<br>Spring 工厂创建时创建<br>如需要懒加载，bean 添加标签 lazy-init=&quot;true&quot;<br>prototype<br>按需加载，当 ac.getBean()调用时<br></code></pre></td></tr></table></figure><h2 id="2、初始化阶段"><a href="#2、初始化阶段" class="headerlink" title="2、初始化阶段"></a>2、初始化阶段</h2><blockquote><p>spring 工厂创建完对象后，调用对象的初始化方法，完成对应的初始化操作</p><p>初始化方法：</p></blockquote><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">程序员根据需求提供<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">Spring工厂进行调用<br></code></pre></td></tr></table></figure><ul><li>initializingBean 接口</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterPropertiesSet</span><span class="hljs-params">()</span><br></code></pre></td></tr></table></figure><ul><li>对象中提供一个普通的方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myInit</span><span class="hljs-params">()</span>;<br>&lt;bean id=<span class="hljs-string">&quot;product&quot;</span> class=<span class="hljs-string">&quot;xxx.product&quot;</span> init-method=<span class="hljs-string">&quot;myInit&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><ul><li>细节<ul><li>1、如果两种初始化方法同时出现，先 initializingBean 再普通方法</li><li>2、 注入发生在初始化操作之前</li><li>3、初始化：数据库、IO、网络</li></ul></li></ul><h2 id="3、销毁阶段"><a href="#3、销毁阶段" class="headerlink" title="3、销毁阶段"></a>3、销毁阶段</h2><blockquote><p>销毁对象前，会调用销毁方法，完成销毁操作</p><p>Spring 什么时候销毁所创建的对象？</p><p>销毁方法：</p></blockquote><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stata"><span class="hljs-keyword">ac</span>.<span class="hljs-keyword">close</span>()<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">程序员根据需求tig<br></code></pre></td></tr></table></figure><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs">Spring工厂完成调用<br></code></pre></td></tr></table></figure><ul><li>DisposableBean 接口</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destory</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><ul><li>自定义销毁方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myDestory</span><span class="hljs-params">()</span>;<br>&lt;bean id=<span class="hljs-string">&quot;product&quot;</span> class=<span class="hljs-string">&quot;xxx.product&quot;</span> destory-method=<span class="hljs-string">&quot;myDestory&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><ul><li>细节<ul><li>1、销毁方法只适用于 singleton</li><li>2、销毁：主要是资源的释放</li></ul></li></ul><h2 id="4、生命周期总结"><a href="#4、生命周期总结" class="headerlink" title="4、生命周期总结"></a>4、生命周期总结</h2><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FjlS8FpuTMrN2-qjfk2cJ7I5nhta.png" srcset="/img/loading.gif" lazyload></p><h1 id="九、自定义类型转换器"><a href="#九、自定义类型转换器" class="headerlink" title="九、自定义类型转换器"></a>九、自定义类型转换器</h1><h2 id="1、类型转换器"><a href="#1、类型转换器" class="headerlink" title="1、类型转换器"></a>1、类型转换器</h2><blockquote><p>作用：Spring 使用类型转换器将配置文件中字符串数据转换为成员变量中对应类型的数据</p></blockquote><h2 id="2、自定义类型转换器"><a href="#2、自定义类型转换器" class="headerlink" title="2、自定义类型转换器"></a>2、自定义类型转换器</h2><blockquote><p>Spring 没有提供特类型转换时，需要自己自定义</p></blockquote><h3 id="1、实现-converter-接口、再自定义"><a href="#1、实现-converter-接口、再自定义" class="headerlink" title="1、实现 converter 接口、再自定义"></a>1、实现 converter 接口、再自定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Converter</span>&lt;String, Date&gt; &#123;<br>  <span class="hljs-comment">/*** 将字符串类型转换为Date类型</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> s 代表配置文件中日期字符串</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> date 当转换好当date作为converter方法返回值时，Spring自动为birthday进行注入 */</span><br>  <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">convert</span><span class="hljs-params">(String s)</span> &#123;<br>    <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>);<br>      date = sdf.parse(s);<br>    &#125;<span class="hljs-keyword">catch</span> (ParseException e)&#123;<br>      e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> date;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2、在-spring-配置文件进行配置"><a href="#2、在-spring-配置文件进行配置" class="headerlink" title="2、在 spring 配置文件进行配置"></a>2、在 spring 配置文件进行配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--自定义的MyDateConverter--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;mydateConverter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;xxx.MydateConverter&quot;</span>/&gt;</span><br><br><span class="hljs-comment">&lt;!--将自定义转换器注册进spring--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversionService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;converters&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">set</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">ref</span> <span class="hljs-attr">bean</span>=<span class="hljs-string">&quot;myDateConverter&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">set</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="3、细节"><a href="#3、细节" class="headerlink" title="3、细节"></a>3、细节</h3><ul><li>解耦合</li></ul><blockquote><p>转换器依赖于”yyyy-MM-dd”，可以将其单独配置。</p><p>做少量变动即可，其他不变，减少耦合</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDateConverter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Converter</span>&lt;String, Date&gt; &#123;<br>  <span class="hljs-keyword">private</span> String pattern;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setPattern</span><span class="hljs-params">(String pattern)</span> &#123;<br>    <span class="hljs-built_in">this</span>.pattern = pattern;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> Date <span class="hljs-title function_">convert</span><span class="hljs-params">(String s)</span> &#123;<br>    <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">SimpleDateFormat</span> <span class="hljs-variable">sdf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleDateFormat</span>(pattern);<br>      date = sdf.parse(s);<br>    &#125;<span class="hljs-keyword">catch</span> (ParseException e)&#123;<br>      e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> date;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myDateConverter&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.converter.MyDateConverter&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;pattern&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;yyyy-MM-dd&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>注册类型转换器时 id 属性不能变，必须是 conversionService</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;conversionService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>spring 有内置日期转换器，其格式为</li></ul><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex">2020/11/05<br></code></pre></td></tr></table></figure><h1 id="十、后置处理-Bean"><a href="#十、后置处理-Bean" class="headerlink" title="十、后置处理 Bean"></a>十、后置处理 Bean</h1><blockquote><p>BeanpostProcessor 作用：对 Spring 工厂创建的对象再加工</p></blockquote><h2 id="1、实现-BeanPostProcessor-接口并配置进容器"><a href="#1、实现-BeanPostProcessor-接口并配置进容器" class="headerlink" title="1、实现 BeanPostProcessor 接口并配置进容器"></a>1、实现 BeanPostProcessor 接口并配置进容器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//实战中：一般只用实现一个after即可，要实现before必须返回bean对象</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBeanPostProcessor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BeanPostProcessor</span> &#123;<br>  <span class="hljs-comment">//spring创建完对象，并进行注入后，允许before方法进行加工</span><br>  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessBeforeInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-keyword">return</span> bean;<br>  &#125;<br>	<span class="hljs-comment">//spring执行完对象的初始化操作后，允许after进行加工</span><br>  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">postProcessAfterInitialization</span><span class="hljs-params">(Object bean, String beanName)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-keyword">if</span>(bean <span class="hljs-keyword">instanceof</span> Category) &#123;<br>      <span class="hljs-type">Category</span> <span class="hljs-variable">category</span> <span class="hljs-operator">=</span> (Category) bean;<br>      category.setName(<span class="hljs-string">&quot;sk&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">return</span> bean;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2、细节"><a href="#2、细节" class="headerlink" title="2、细节"></a>2、细节</h2><ul><li>BeanPostProcessor 会对工厂创建的所有的对象进行加工 ，所有针对特定嘞需要做特殊处理</li></ul><h1 id="十一、AOP"><a href="#十一、AOP" class="headerlink" title="十一、AOP"></a>十一、AOP</h1><h2 id="1、静态代理设计模式"><a href="#1、静态代理设计模式" class="headerlink" title="1、静态代理设计模式"></a>1、静态代理设计模式</h2><ul><li>dao service controller 三层架构中，service 层最重要</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/Fko2wICL4WvPaWAqVUxuzw8Aq2DG.png" srcset="/img/loading.gif" lazyload></p><ul><li>为什么要使用代理</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FkX4aKBMtLPctFt7zPneTwH73F7q.png" srcset="/img/loading.gif" lazyload></p><h3 id="1、代理设计模式"><a href="#1、代理设计模式" class="headerlink" title="1、代理设计模式"></a>1、代理设计模式</h3><blockquote><p>定义：通过代理类为原始类增加额外功能，有利于原始类的维护</p></blockquote><ul><li>静态代理的问题：静态嘞文件数量过多，不利于项目管理</li></ul><h2 id="2、Spring-动态代理"><a href="#2、Spring-动态代理" class="headerlink" title="2、Spring 动态代理"></a>2、Spring 动态代理</h2><blockquote><p>通过代理类为被代理类实现功能增强，利于维护</p></blockquote><h3 id="1、创建被代理类"><a href="#1、创建被代理类" class="headerlink" title="1、创建被代理类"></a>1、创建被代理类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUserService</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span>;<br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String name,String password)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span>&#123;<br>  <span class="hljs-keyword">private</span> <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---log---&quot;</span>);<br>    userService.register(user);<br>  &#125;<br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String name, String password)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---log---&quot;</span>);<br>    <span class="hljs-keyword">return</span> userService.login(name, password);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2、创建类实现-MethodBeforeAdvice"><a href="#2、创建类实现-MethodBeforeAdvice" class="headerlink" title="2、创建类实现 MethodBeforeAdvice"></a>2、创建类实现 MethodBeforeAdvice</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Before</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodBeforeAdvice</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">before</span><span class="hljs-params">(Method method, Object[] objects, Object o)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>    System.out.println(<span class="hljs-string">&quot;----method before advice log---&quot;</span>);<br>  &#125;<br>&#125;<br><br>&lt;bean id=<span class="hljs-string">&quot;before&quot;</span> class=<span class="hljs-string">&quot;xx.Before&quot;</span>/<br></code></pre></td></tr></table></figure><h3 id="3、定义切入点"><a href="#3、定义切入点" class="headerlink" title="3、定义切入点"></a>3、定义切入点</h3><blockquote><p>额外功能加入的位置</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--所有方法都作为切入点--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *(..))&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="4、组装"><a href="#4、组装" class="headerlink" title="4、组装"></a>4、组装</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--所有方法都作为切入点--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* *(..))&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!--所有方法都加入before的额外功能--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;before&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pc&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="5、调用"><a href="#5、调用" class="headerlink" title="5、调用"></a>5、调用</h3><blockquote><p>注意：</p><p>spring 工厂通过原始对象 id 获取到的是代理对象</p><p>获得代理对象之后，可以通过声明接口类型进行对象的存储</p></blockquote><h2 id="3、动态代理细节分析"><a href="#3、动态代理细节分析" class="headerlink" title="3、动态代理细节分析"></a>3、动态代理细节分析</h2><ul><li>Spring 框架运行时，通过动态字节码技术，在 JVM 创建 Spring 动态代理类，运行在 JVM 内部</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/Foip_3dWONBhMS5w_VJQ633_LqCs.png" srcset="/img/loading.gif" lazyload></p><ul><li>动态代理编程简化代理的开发</li></ul><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs latex">在额外功能不改变的前提下，创建其他目标类的代理对象时，只需要指定原始对象即可<br></code></pre></td></tr></table></figure><ul><li>动态代理额外功能的 维护性增强</li></ul><h2 id="4、Spring-动态代理详解"><a href="#4、Spring-动态代理详解" class="headerlink" title="4、Spring 动态代理详解"></a>4、Spring 动态代理详解</h2><h3 id="1、额外功能详解"><a href="#1、额外功能详解" class="headerlink" title="1、额外功能详解"></a>1、额外功能详解</h3><ul><li>MethodBeforeAdvice 分析</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">MethodBeforeAdvice:在原始方法执行之前的增强需要实现此接口<br></code></pre></td></tr></table></figure><ul><li>MethodInterceptor 分析</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">MethodInterceptor:对原始方法进行环绕增强<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Around</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MethodInterceptor</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 额外操作都写在invoke里</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> methodInvocation</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 原始方法返回值作为invoke方法返回值,MethodInterceptor不会影响原始方法的返回值,若需要改变，也很简单，不直接返回invoke的返回值即可</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@throws</span> Throwable</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(MethodInvocation methodInvocation)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>      System.out.println(<span class="hljs-string">&quot;前置通知&quot;</span>);<br>      <span class="hljs-keyword">try</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;前通知&quot;</span>);<br>        <span class="hljs-comment">//即原始类中的方法运行</span><br>        ret = methodInvocation.proceed();<br>        System.out.println(<span class="hljs-string">&quot;后置通知&quot;</span>);<br>      &#125;<span class="hljs-keyword">catch</span> (Exception e)&#123;<br>        System.out.println(<span class="hljs-string">&quot;异常通知&quot;</span>);<br>      &#125;<span class="hljs-keyword">finally</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;最终通知&quot;</span>);<br>        <span class="hljs-keyword">return</span> ret;<br>      &#125;<br>    &#125;<br>  &#125;<br></code></pre></td></tr></table></figure><h3 id="2、切入点表达式"><a href="#2、切入点表达式" class="headerlink" title="2、切入点表达式"></a>2、切入点表达式</h3><ul><li><p>定义一个方法</p><table><thead><tr><th>访问修饰符</th><th>返回值</th><th>方法名</th><th>参数列表</th></tr></thead><tbody><tr><td>public</td><td>void</td><td>service</td><td>String,Integer</td></tr></tbody></table></li><li><p>定义切入点表达式不需要管返回值</p></li></ul><p><strong>非 java.lang 包中的类需要写全限定类名</strong></p><h4 id="方法切入点表达式"><a href="#方法切入点表达式" class="headerlink" title="方法切入点表达式"></a>方法切入点表达式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//方法名为login两个参数均为string才可以</span><br>* com.lqs.service.userService.login(String,String)<br></code></pre></td></tr></table></figure><h4 id="类切入点表达式"><a href="#类切入点表达式" class="headerlink" title="类切入点表达式"></a>类切入点表达式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//写法一：类中所有方法加入额外功能</span><br>* com.lqs.service.userService.*(..)<br><span class="hljs-comment">//忽略包</span><br><span class="hljs-comment">//类只存在一级包</span><br>* userService.*(..)<br><span class="hljs-comment">//类存在多级包</span><br>* *..userService.*(..)<br></code></pre></td></tr></table></figure><h4 id="包切入点表达式（最常用）"><a href="#包切入点表达式（最常用）" class="headerlink" title="包切入点表达式（最常用）"></a>包切入点表达式（最常用）</h4><ul><li>指定包作为额外功能加入的位置，自然保重所有类及方法都会加入额外的功能</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//语法1:切入点包中所有类，必须在proxy中，不能在proxy的子包中</span><br>* com.lqs.proxy.*.*(..)<br><span class="hljs-comment">//语法2：切入点当前包及子包都生效</span><br>* com.lqs.proxy..*.*(..)<br></code></pre></td></tr></table></figure><h4 id="切入点函数"><a href="#切入点函数" class="headerlink" title="切入点函数"></a>切入点函数</h4><ul><li>execution<ul><li>最重要的切入点函数</li><li>切入点：可执行上述三种切入点表达式</li><li>缺点：书写麻烦</li></ul></li><li>args<ul><li>用于函数参数的匹配</li><li>切入点：方法参数必须时 2 个字符串类型的参数</li><li>eg：execution(_ _(String,String)) &#x3D;&#x3D; args(String,String)</li></ul></li><li>within<ul><li>用于进行类，包切入点表达式的匹配</li><li>切入点：类</li><li>eg：execution(_ <em>..userService.</em>(..)). &#x3D;&#x3D; within（_..userService)</li></ul></li><li><a href="/annotation">@annotation</a><ul><li>为具有特殊注解的方法加入额外功能</li><li>eg：<a href="/com.lqs.Log">@annotation(com.lqs.Log)</a></li></ul></li><li>切入点函数的逻辑运算<ul><li>整合多个切入点函数配合工作，进而完成复杂的需求</li><li>and 与操作<ul><li>注意：不能用于同类型的切入点函数</li><li>eg：execution(_ login(_ <em>)) and args(String,String) &#x3D;&#x3D; execution(</em> login(String,String))</li></ul></li><li>or 或操作<ul><li>eg：execution(_ login(..)) or execution(_ register(..))</li></ul></li></ul></li></ul><h2 id="5、AOP-编程"><a href="#5、AOP-编程" class="headerlink" title="5、AOP 编程"></a>5、AOP 编程</h2><ul><li>AOP 开发步骤<ul><li>原始对象</li><li>额外功能</li><li>切入点</li><li>组装切面</li></ul></li><li>AOP 创建代理对象原理</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FrDOzKGEe2dgAaErVK7q_ctbkYWu.png" srcset="/img/loading.gif" lazyload></p><h2 id="1、基于-Cglib"><a href="#1、基于-Cglib" class="headerlink" title="1、基于 Cglib"></a>1、基于 Cglib</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-keyword">final</span> String[] args)</span> &#123;<br>  <span class="hljs-type">UserService</span> <span class="hljs-variable">cglibService</span> <span class="hljs-operator">=</span> (UserService) Enhancer.create(userService.getClass(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">MethodInterceptor</span>() &#123;<br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">intercept</span><span class="hljs-params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>      System.out.println(<span class="hljs-string">&quot;---cglib---proxy&quot;</span>);<br>      <span class="hljs-keyword">return</span> method.invoke(userService, objects);&#125;&#125;);<br>  cglibService.register(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>());<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2、基于-JDK"><a href="#2、基于-JDK" class="headerlink" title="2、基于 JDK"></a>2、基于 JDK</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>  <span class="hljs-comment">//1、原始对象</span><br>  <span class="hljs-comment">//jdk8.0之前需要将其声明为final</span><br>  <span class="hljs-type">IUserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br>  <span class="hljs-comment">//2、JDK动态代理</span><br>  <span class="hljs-type">IUserService</span> <span class="hljs-variable">proxyService</span> <span class="hljs-operator">=</span> (IUserService) Proxy.newProxyInstance(userService.getClass().getClassLoader(), userService.getClass().getInterfaces(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>() &#123;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy, Method method, Object[] args)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>      System.out.println(<span class="hljs-string">&quot;----before&quot;</span>);<br>      <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> method.invoke(userService, args);<br>      System.out.println(<span class="hljs-string">&quot;----after&quot;</span>);<br>      <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>  &#125;);<br>  <span class="hljs-comment">//3使用</span><br>  proxyService.login(<span class="hljs-string">&quot;lqs&quot;</span>,<span class="hljs-string">&quot;qejaldms&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FupFx2VJM5_rDWQMpHHItZHWxh2w.png" srcset="/img/loading.gif" lazyload></p><h1 id="十二、基于注解的-AOP"><a href="#十二、基于注解的-AOP" class="headerlink" title="十二、基于注解的 AOP"></a>十二、基于注解的 AOP</h1><h2 id="1、简单使用"><a href="#1、简单使用" class="headerlink" title="1、简单使用"></a>1、简单使用</h2><ul><li>定义被代理类和切面类</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---log---&quot;</span>);<br>  &#125;<br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String name, String password)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---log---&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;&#125;<br>&#125;<br><span class="hljs-meta">@Aspect</span><span class="hljs-comment">//这是一个切面类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspect</span> &#123;<br>  <span class="hljs-meta">@Around(&quot;execution(* login(..))&quot;)</span><span class="hljs-comment">//定义切入点</span><br>  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>    System.out.println(<span class="hljs-string">&quot;aspect---before&quot;</span>);<span class="hljs-comment">//自定义方法增强</span><br>    <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> joinPoint.proceed();<span class="hljs-comment">//代表被代理类方法</span><br>    System.out.println(<span class="hljs-string">&quot;aspect---after&quot;</span>);<br>    <span class="hljs-keyword">return</span> ret;<span class="hljs-comment">//返回</span><br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>配置文件</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--告知spring进行基于注解的aop编程--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span>/&gt;</span><br><span class="hljs-comment">&lt;!--配置被代理类--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;userService&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.aspect.UserService&quot;</span>/&gt;</span><br><span class="hljs-comment">&lt;!--配置切面类--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;myAspect&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.lqs.aspect.MyAspect&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><h2 id="2、细节-1"><a href="#2、细节-1" class="headerlink" title="2、细节"></a>2、细节</h2><ul><li>切入点复用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><span class="hljs-comment">//这是一个切面类</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspect</span> &#123;<br>	<span class="hljs-comment">//定义可复用切入点</span><br>  <span class="hljs-meta">@Pointcut(&quot;execution(* register(..))&quot;)</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">myPointCut</span><span class="hljs-params">()</span>&#123;&#125;<br><br>  <span class="hljs-meta">@Around(value = &quot;myPointCut()&quot;)</span><span class="hljs-comment">//使用自定义切入点</span><br>  <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around2</span><span class="hljs-params">(ProceedingJoinPoint joinPoint)</span> <span class="hljs-keyword">throws</span> Throwable &#123;<br>    System.out.println(<span class="hljs-string">&quot;aspect---before tx&quot;</span>);<br>    <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> joinPoint.proceed();<br>    System.out.println(<span class="hljs-string">&quot;aspect---after tx&quot;</span>);<br>    <span class="hljs-keyword">return</span> ret;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>spring 对 jdkproxy 和 cglib 的切换</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml">//false:默认值，即使用jdkproxy<br>//true:使用cglib<br><span class="hljs-tag">&lt;<span class="hljs-name">aop:aspectj-autoproxy</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span>//基于注解的<br><span class="hljs-tag">&lt;<span class="hljs-name">aop:aconfig</span> <span class="hljs-attr">proxy-target-class</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>//基于配置的<br></code></pre></td></tr></table></figure><h2 id="3、开发常见的坑"><a href="#3、开发常见的坑" class="headerlink" title="3、开发常见的坑"></a>3、开发常见的坑</h2><ul><li>在同一个业务类中进行方法间的相互调用，只有最外层方法才进行方法增强（内部方法通过普通调用的都是未增强的方法）</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---register---&quot;</span>);<br>    <span class="hljs-comment">//当出现此种调用时，this指的被代理对象，方法没有被增强</span><br>    <span class="hljs-built_in">this</span>.login(<span class="hljs-string">&quot;suns&quot;</span>, <span class="hljs-string">&quot;qkdokd&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String name, String password)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---login---&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>解决方法:通过实现 ApplicationContextAware 获得 applicationContext，再创建</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span>, ApplicationContextAware &#123;<br><br>  <span class="hljs-keyword">private</span> ApplicationContext ctx;<br>  <span class="hljs-meta">@Override</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setApplicationContext</span><span class="hljs-params">(ApplicationContext applicationContext)</span> <span class="hljs-keyword">throws</span> BeansException &#123;<br>    <span class="hljs-built_in">this</span>.ctx = applicationContext;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">register</span><span class="hljs-params">(User user)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---register---&quot;</span>);<br>    <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> (UserService)ctx.getBean(<span class="hljs-string">&quot;userService&quot;</span>);<br>    userService.login(<span class="hljs-string">&quot;suns&quot;</span>, <span class="hljs-string">&quot;qkdokd&quot;</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String name, String password)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;---login---&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment">aspect---before--register</span><br><span class="hljs-comment">---register---</span><br><span class="hljs-comment">aspect---before--login</span><br><span class="hljs-comment">---login---</span><br><span class="hljs-comment">aspect---after--login</span><br><span class="hljs-comment">aspect---after--register</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><h2 id="4、AOP-总结"><a href="#4、AOP-总结" class="headerlink" title="4、AOP 总结"></a>4、AOP 总结</h2><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/Ftk5_KYKKIRQSRQqUJxM8lSooX3I.png" srcset="/img/loading.gif" lazyload></p><h1 id="十三、Spring-整合-Mybatis"><a href="#十三、Spring-整合-Mybatis" class="headerlink" title="十三、Spring 整合 Mybatis"></a>十三、Spring 整合 Mybatis</h1><h2 id="1、Spring-整合-Mybatis"><a href="#1、Spring-整合-Mybatis" class="headerlink" title="1、Spring 整合 Mybatis"></a>1、Spring 整合 Mybatis</h2><ul><li>配置文件：spring-mybatis.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--连接池--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;mysql.driver&#125;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;mysql.url&#125;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;mysql.user&#125;&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$&#123;mysql.password&#125;&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--sqlSessionFactory--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--数据源--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!--绑定mybatis全局配置文件--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;configLocation&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!--绑定mapper路径--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;mapperLocations&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;classpath:mapper/*.xml&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!--扫描entity包，使用别名--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.blog.pojo&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--配置dao扫描包，实现dao接口动态注入到容器中--&gt;</span><br><span class="hljs-comment">&lt;!--maperScannerConfigure创建的dao对象id值为mapper接口首字母小写--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--注入sqlSessionFactory--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span>/&gt;</span><br>  <span class="hljs-comment">&lt;!--要扫描的包--&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.blog.mapper&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>Java 编码</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 实体<br>   2、表<br><span class="hljs-bullet">2.</span> DAO 接口<br><span class="hljs-bullet">3.</span> Mapper 配置文件<br></code></pre></td></tr></table></figure><h2 id="2、整合细节"><a href="#2、整合细节" class="headerlink" title="2、整合细节"></a>2、整合细节</h2><ul><li>为什么 dao 不提交事务，但是数据可以插入进数据库 ？</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">spring 整合 mybatis 时，引入了外部连接池对象，保持自动的事务提交机制，不需要手工进行事务的操作，也能进行事务提交<br></code></pre></td></tr></table></figure><h1 id="十四、Spring-事务处理"><a href="#十四、Spring-事务处理" class="headerlink" title="十四、Spring 事务处理"></a>十四、Spring 事务处理</h1><h2 id="1、Spring-事务处理"><a href="#1、Spring-事务处理" class="headerlink" title="1、Spring 事务处理"></a>1、Spring 事务处理</h2><blockquote><p>保证业务操作完整性的一种数据库机制</p><p>事务 4 特点：A 原子性、C 一致性、I 隔离性、D 持久性</p></blockquote><ul><li>使用 AOP 进行事务开发</li></ul><h2 id="2、事务属性"><a href="#2、事务属性" class="headerlink" title="2、事务属性"></a>2、事务属性</h2><h3 id="1、隔离属性"><a href="#1、隔离属性" class="headerlink" title="1、隔离属性"></a>1、隔离属性</h3><ul><li><p>并发：多个事务在统一时间，访问并操作了相同的数据</p></li><li><p>并发产生的问题</p><ul><li>脏读：一个事务读取另一个事务没有提交的数据，会在本事务产生数据不一致的问题</li><li>幻读：</li><li>不可重复读</li></ul></li><li><p>如何解决：通过隔离属性解决，隔离属性设置不同的值</p><ul><li>脏读：<a href="/Transactional(isolation">@Transactional(isolation </a>&#x3D; Isolation.READ_COMMITTED)<table><thead><tr><th></th><th>脏读</th><th>不可重复读</th><th>幻读</th><th>ORACLE 支持</th><th>MYSQL 支持</th></tr></thead><tbody><tr><td></td><td>一个事务读取另一个事务没有提交的数据，会在本事务产生数据不一致的问题</td><td>同一个事务中，多次读取到的数据不一致</td><td>一个事务读取数据时，另外一个事务进行更新，导致第一个事务读取到了没有更新的数据</td><td></td><td></td></tr><tr><td>READ_UNCOMMITTED</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td><td>Y</td></tr><tr><td>READ_COMMITTED</td><td>N</td><td>Y</td><td>Y</td><td>Y(Default)</td><td>Y</td></tr><tr><td>REPEATABLE_READ：一把行锁</td><td>N</td><td>N</td><td>Y</td><td>N</td><td>Y(Default)</td></tr><tr><td>SERIALIZABLE：表锁</td><td>N</td><td>N</td><td>N</td><td>Y</td><td>Y</td></tr></tbody></table></li></ul></li><li><p>并发安全：从上到下递增（除开 READ_UNCOMMITTED）</p></li><li><p>运行效率：从上到下递减（除开 READ_UNCOMMITTED）</p></li><li><p>ORACLE 使用多版本比对的方式，解决不可重复读的问题</p></li><li><p>ISOLATION_DEFAULT：调用不同数据库设置的默认隔离属性</p><ul><li>Mysql 查看默认隔离级别</li></ul></li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> @<span class="hljs-variable">@transaction</span>_isolation;<br></code></pre></td></tr></table></figure><ul><li>Oracle</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> s.sid, s.serial#,<br><br>　　<span class="hljs-keyword">CASE</span> BITAND(t.flag, <span class="hljs-built_in">POWER</span>(<span class="hljs-number">2</span>, <span class="hljs-number">28</span>))<br>　　　　<span class="hljs-keyword">WHEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span> <span class="hljs-string">&#x27;READ COMMITTED&#x27;</span><br>　　　　<span class="hljs-keyword">ELSE</span> <span class="hljs-string">&#x27;SERIALIZABLE&#x27;</span><br>　　<span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> isolation_level<br><span class="hljs-keyword">FROM</span> v$transaction t<br><span class="hljs-keyword">JOIN</span> v$session s <span class="hljs-keyword">ON</span> t.addr <span class="hljs-operator">=</span> s.taddr <span class="hljs-keyword">AND</span> s.sid <span class="hljs-operator">=</span> sys_context(<span class="hljs-string">&#x27;USERENV&#x27;</span>, <span class="hljs-string">&#x27;SID&#x27;</span>);<br></code></pre></td></tr></table></figure><ul><li>隔离属性实战建议<ul><li>推荐使用指定默认值</li><li>实战中并发比较少，真正遇到并发问题，可以使用乐观锁</li></ul></li></ul><h3 id="2、传播属性"><a href="#2、传播属性" class="headerlink" title="2、传播属性"></a>2、传播属性</h3><blockquote><p>事务解决嵌套问题的特征</p><p>问题：大事务中有很多小事务，彼此影响，最终导致外部大事务丧失事务原子性</p></blockquote><table><thead><tr><th>传播属性的值</th><th>外部不存在事务</th><th>外部存在事务</th><th>备注</th></tr></thead><tbody><tr><td>REQUIRED(default)</td><td>开启新的事务</td><td>融合到外部事务中</td><td>增删改方法</td></tr><tr><td>SUPPORTS</td><td>不开启新的事务</td><td>融合到外部事务中</td><td>查询</td></tr><tr><td>REQUIRES_NEW</td><td>开启新的事务</td><td>挂起外部事务，创建新事务，执行完之后再执行外部事务</td><td>日志记录方法</td></tr><tr><td>NOT_SUPPORTED</td><td>不开启新的事务</td><td>挂起外部事务</td><td>不常用</td></tr><tr><td>NEVER</td><td>不开启新的事务</td><td>抛出异常</td><td>不常用</td></tr><tr><td>MANDATORY</td><td>抛出异常</td><td>融合到外部事务中</td><td>不常用</td></tr></tbody></table><ul><li>使用方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span>=Propagation.REQUIRED<br></code></pre></td></tr></table></figure><ul><li>注意<ul><li>增删改不用写传播属性，用默认值即可</li></ul></li></ul><h3 id="3、只读属性"><a href="#3、只读属性" class="headerlink" title="3、只读属性"></a>3、只读属性</h3><blockquote><p>针对只进行查询操作的业务方法，可以加入只读属性，提高运行效率</p><p>默认值为 false</p></blockquote><ul><li>使用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">readonly=<span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><h3 id="4、超时属性"><a href="#4、超时属性" class="headerlink" title="4、超时属性"></a>4、超时属性</h3><blockquote><p>指定事务等待的最长时间</p><p>为什么事务进行等待？</p><p>答：事务访问数据时，如果有其他事务正在操作事务，此时需要等待</p></blockquote><ul><li>等待时间，单位为秒</li><li>使用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional</span>=(timeout=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><ul><li>default &#x3D; -1</li><li>最终数据由数据库指定</li></ul><h3 id="5、异常属性"><a href="#5、异常属性" class="headerlink" title="5、异常属性"></a>5、异常属性</h3><blockquote><p>Spring 事务处理过程中，默认异常处理</p><p>RuntimeException: 回滚</p><p>Exception 及其子类：提交</p></blockquote><ul><li>处理方法</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Transactional(rollbackFor = &#123;java.lang.Exception, xxx, xxx&#125;)</span><br>noRollbackFor = &#123;&#125;<br></code></pre></td></tr></table></figure><h2 id="3、事务属性总结"><a href="#3、事务属性总结" class="headerlink" title="3、事务属性总结"></a>3、事务属性总结</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 隔离属性 默认值<br><span class="hljs-bullet">2.</span> 传播属性 Required(默认值) 增删改 Supports 查询操作<br><span class="hljs-bullet">3.</span> 只读属性 false(默认值) 增删改 true 查询操作<br><span class="hljs-bullet">4.</span> 超时属性 -1<br><span class="hljs-bullet">5.</span> 异常属性 默认值<br><br>增删改操作：@Transactional<br>查询操作 @Transactional(propagation=Propagation.SUPPORTS, readonly=true)<br></code></pre></td></tr></table></figure><h2 id="4、基于标签的事务配置方式"><a href="#4、基于标签的事务配置方式" class="headerlink" title="4、基于标签的事务配置方式"></a>4、基于标签的事务配置方式</h2><ul><li>比较麻烦</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--事务属性--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">tx:advice</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;texAdvice&quot;</span> <span class="hljs-attr">transaction-manager</span>=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">tx:attributes</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--等效于@Transactional public void register()--&gt;</span><br>  	<span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;register&quot;</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;login&quot;</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br>    <span class="hljs-comment">&lt;!--所有以modify属性开头的方法都这么配置--&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">tx:method</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;modify*&quot;</span> <span class="hljs-attr">isolation</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">propagation</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">tx:method</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">tx:attributes</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">tx:advice</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">aop:config</span>&gt;</span><br>  <span class="hljs-comment">&lt;!--service包下所有方法--&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">aop:pointcut</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;pc&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;execution(* com.lqs.service..*.*(..))&quot;</span>/&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">aop:advisor</span> <span class="hljs-attr">advice-ref</span>=<span class="hljs-string">&quot;txAdvice&quot;</span> <span class="hljs-attr">pointcut-ref</span>=<span class="hljs-string">&quot;pc&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">aop:config</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="十五、Spring-整合-mvc"><a href="#十五、Spring-整合-mvc" class="headerlink" title="十五、Spring 整合 mvc"></a>十五、Spring 整合 mvc</h1><h2 id="1、Spring-整合-MVC-核心思路"><a href="#1、Spring-整合-MVC-核心思路" class="headerlink" title="1、Spring 整合 MVC 核心思路"></a>1、Spring 整合 MVC 核心思路</h2><h3 id="1、准备工厂"><a href="#1、准备工厂" class="headerlink" title="1、准备工厂"></a>1、准备工厂</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> web 开发如何创建工厂<br>   ApplicationContext ctx = new ClassPathXmlApplicationContext(&quot;/applicationContext.xml&quot;)<br>   //改成 WebXmlApplicationContext<br><span class="hljs-bullet">2.</span> 如何保证工厂唯一同时被使用<br>   被共用：Web request | session | ServletContext | application<br>   工厂存储在 ServletContext 作用域中<br>   ServletContext.setAttribute(&quot;xxxx&quot;,ctx);<br>   唯一性：借用 ServletContextListener 创建工厂在此执行<br><span class="hljs-bullet">3.</span> 总结<br>   ServletContextListener 中执行：<br>   ApplicationContext ctx = new WebXmlApplicationContext(&quot;/applicationContext.xml&quot;)<br>   ServletContext.setAttribute(&quot;xxxx&quot;,ctx);<br><span class="hljs-bullet">4.</span> spring 整合一个 contextLoaderListener<br>   1、创建工厂<br>   2、把工厂存在 ServletContext 中<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>  <span class="hljs-comment">// Store context in local instance variable, to guarantee that</span><br>  <span class="hljs-comment">// it is available on ServletContext shutdown.</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.context == <span class="hljs-literal">null</span>) &#123;<br><br>    <span class="hljs-built_in">this</span>.context = createWebApplicationContext(servletContext);<br>  &#125;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.context <span class="hljs-keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;<br>    <span class="hljs-type">ConfigurableWebApplicationContext</span> <span class="hljs-variable">cwac</span> <span class="hljs-operator">=</span> (ConfigurableWebApplicationContext) <span class="hljs-built_in">this</span>.context;<br>    <span class="hljs-keyword">if</span> (!cwac.isActive()) &#123;<br>      <span class="hljs-comment">// The context has not yet been refreshed -&gt; provide services such as</span><br>      <span class="hljs-comment">// setting the parent context, setting the application context id, etc</span><br>      <span class="hljs-keyword">if</span> (cwac.getParent() == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-comment">// The context instance was injected without an explicit parent -&gt;</span><br>        <span class="hljs-comment">// determine parent for root web application context, if any.</span><br>        <span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> loadParentContext(servletContext);<br>        cwac.setParent(parent);<br>      &#125;<br>      configureAndRefreshWebApplicationContext(cwac, servletContext);<br>    &#125;<br>  &#125;<br><br>servletContext.setAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE, <span class="hljs-built_in">this</span>.context);<br></code></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--contextLoaderListener使用方式--&gt;</span><br>在web.xml<br><span class="hljs-tag">&lt;<span class="hljs-name">listener</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hljs-tag">&lt;/<span class="hljs-name">listener-class</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">listener</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--指定配置文件--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">context-param</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">param-name</span>&gt;</span>contextConfigLocation<span class="hljs-tag">&lt;/<span class="hljs-name">param-name</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">param-value</span>&gt;</span>classpath:applicationContext.xml<span class="hljs-tag">&lt;/<span class="hljs-name">param-value</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">context-param</span>&gt;</span><br></code></pre></td></tr></table></figure><h1 id="十六、注解开发"><a href="#十六、注解开发" class="headerlink" title="十六、注解开发"></a>十六、注解开发</h1><blockquote><p>注解的作用</p><p>替换 xml 配置，简化配置</p><p>替换接口，实现调用双方的契约性质</p><p>对已添加的注解不满意，可以通过配置文件进行覆盖</p></blockquote><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FuxWMZyls54ONJUfhliX4zN3f17p.png" srcset="/img/loading.gif" lazyload></p><h2 id="1、对象创建注解"><a href="#1、对象创建注解" class="headerlink" title="1、对象创建注解"></a>1、对象创建注解</h2><ul><li>搭建开发环境</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.lqs&quot;</span>/&gt;</span><br>作用：让spring框架扫描设置包内的注解，使其生效<br></code></pre></td></tr></table></figure><ul><li><a href="/Component">@Component</a></li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs markdown">作用：替换原有 spring 配置文件的<span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span>&gt;</span></span>标签<br>具体：id 默认值为类首字母小写<br>class 属性为类全限定类名<br>注意：若配置文件需要覆盖注解的值，id 值必须相同<br>衍生注解：<br>@Repository：用在持久层<br>@Service：用在业务层<br>@Controller：用在控制器层<br></code></pre></td></tr></table></figure><ul><li><a href="/Scope">@Scope</a><br>确定粒度</li><li>@PostConstruct：初始化<br>@PreDestroy：销毁<br>JSR520 提供</li><li><a href="/Lazy">@Lazy</a><br>延迟创建单实例对象</li></ul><h2 id="2、注入相关注解"><a href="#2、注入相关注解" class="headerlink" title="2、注入相关注解"></a>2、注入相关注解</h2><h3 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired "></a><a href="/Autowired">@Autowired</a></h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> 基于类型注入：注入对象类型必须与目标成员变量相同或者其子类<br><span class="hljs-bullet">-</span> 配合@Qualifier(&quot;id&quot;)<br>  注入对象的 id 值必须与 Qualifier 注解中设置的名字相同<br><span class="hljs-bullet">-</span> 放置位置<br>  a、放在 set 方法上<br>  b、直接放在成员变量上，spring 通过反射直接对成员变量进行注入<br></code></pre></td></tr></table></figure><h3 id="Resource"><a href="#Resource" class="headerlink" title="@Resource "></a><a href="/Resource">@Resource</a></h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> JSR250 提供的<br><span class="hljs-bullet">-</span> 基于名字进行注入<br><span class="hljs-bullet">-</span> 如果名字没有配对成功，会继续按照类型进行注入<br></code></pre></td></tr></table></figure><h3 id="Inject-了解即可"><a href="#Inject-了解即可" class="headerlink" title="@Inject(了解即可)"></a>@Inject(了解即可)</h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> 与@Autowired 完全一致，需要引入 jar 才可以使用<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span></span>javax.inject<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span></span>javax.inject<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span></span>1<span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span></span><br>  <span class="language-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></span><br></code></pre></td></tr></table></figure><h3 id="Value"><a href="#Value" class="headerlink" title="@Value "></a><a href="/Value">@Value</a></h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> 作用：注入 jdk 基本类型<br><span class="hljs-bullet">-</span> 1、设置 xxx.properties<br>  id = 10<br>  name = lqs<br><span class="hljs-bullet">-</span> 2、spring 引入配置文件<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;xxx.properties&quot;</span></span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">-</span> <span class="hljs-attr">3</span>、<span class="hljs-attr">使用</span></span></span><br><span class="hljs-tag"><span class="language-xml">  @<span class="hljs-attr">Value</span>(&quot;<span class="hljs-attr">id</span>&quot;)</span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">private</span> <span class="hljs-attr">int</span> <span class="hljs-attr">id</span>;</span></span><br><span class="hljs-tag"><span class="language-xml"><span class="hljs-attr">-</span> <span class="hljs-attr">注意</span>：</span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">-</span> <span class="hljs-attr">不能用在静态变量上</span></span></span><br><span class="hljs-tag"><span class="language-xml">  <span class="hljs-attr">-</span> <span class="hljs-attr">不能给集合类型注入</span>（<span class="hljs-attr">只能用</span> <span class="hljs-attr">XML</span> <span class="hljs-attr">配置</span>，<span class="hljs-attr">新格式</span> <span class="hljs-attr">YML</span> <span class="hljs-attr">可以注入</span>）</span></span><br></code></pre></td></tr></table></figure><h3 id="PropertySource"><a href="#PropertySource" class="headerlink" title="@PropertySource "></a><a href="/PropertySource">@PropertySource</a></h3><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">-</span> 替换下面<br>  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;xxx.properties&quot;</span></span></span><br></code></pre></td></tr></table></figure><h2 id="3、注解扫描详解"><a href="#3、注解扫描详解" class="headerlink" title="3、注解扫描详解"></a>3、注解扫描详解</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;context:component-scan: base-package=&quot;&quot;/&gt;<br>当前包及其子包，但有时候需要排除<br></code></pre></td></tr></table></figure><h3 id="1、排除方式"><a href="#1、排除方式" class="headerlink" title="1、排除方式"></a>1、排除方式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--type类型：</span><br><span class="hljs-comment">		assignable：排除特定类型，不进行扫描</span><br><span class="hljs-comment">		annotation：排除特定注解</span><br><span class="hljs-comment">		aspectj：切入点表达式实现</span><br><span class="hljs-comment">		regex：正则表达式实现（了解即可）</span><br><span class="hljs-comment">		custom：自定义，框架底层开发（了解即可）</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">		可以使用叠加策略</span><br><span class="hljs-comment">--&gt;</span><br>&lt;context:component-scan: base-package=&quot;&quot;<br>       use-default-filters=&quot;false&quot;&gt; //是否使用默认过滤器<br>  <span class="hljs-tag">&lt;<span class="hljs-name">context:exclude-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br>&lt;/context:component-scan:&gt;<br></code></pre></td></tr></table></figure><h3 id="2、包含方式"><a href="#2、包含方式" class="headerlink" title="2、包含方式"></a>2、包含方式</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--type类型：</span><br><span class="hljs-comment">		assignable：排除特定类型，进行扫描</span><br><span class="hljs-comment">		annotation：排除特定注解</span><br><span class="hljs-comment">		aspectj：切入点表达式实现</span><br><span class="hljs-comment">		regex：正则表达式实现（了解即可）</span><br><span class="hljs-comment">		custom：自定义，框架底层开发（了解即可）</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">		可以使用叠加策略</span><br><span class="hljs-comment">--&gt;</span><br>&lt;context:component-scan: base-package=&quot;&quot;&gt;<br>  <span class="hljs-tag">&lt;<span class="hljs-name">context:include-filter</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">expression</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br>&lt;/context:component-scan:&gt;<br></code></pre></td></tr></table></figure><h2 id="4、注解开发思考"><a href="#4、注解开发思考" class="headerlink" title="4、注解开发思考"></a>4、注解开发思考</h2><ul><li>配置互通</li></ul><h2 id="5、高级注解"><a href="#5、高级注解" class="headerlink" title="5、高级注解"></a>5、高级注解</h2><h3 id="Bean"><a href="#Bean" class="headerlink" title="@Bean "></a><a href="/Bean">@Bean</a></h3><blockquote><p>替代 xml 配置中标签</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> 创建复杂对象时<br>先自定义ConnectionFactorybean实现FactoryBean接口，在配置类中直接调用方法即可<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionFactoryBean</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FactoryBean</span>&lt;Connection&gt;&#123;<br>  <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>    Class.forName(<span class="hljs-string">&quot;com.mysql.jdbc.Driver&quot;</span>);<br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">con</span> <span class="hljs-operator">=</span> DriverManager.getConnection(url, user, password);<br>    <span class="hljs-keyword">return</span> con;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> Class&lt;?&gt; getObjectType()&#123;<br>    <span class="hljs-keyword">return</span> Connection.class;<br>  &#125;<br><br>  <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSingleton</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>  &#125;<br>&#125;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span>&#123;<br>  <span class="hljs-meta">@Bean(&quot;connection&quot;)</span><span class="hljs-comment">//自定义id</span><br>  <span class="hljs-meta">@Scope(&quot;singleton | prototype&quot;)</span><span class="hljs-comment">//指定创建次数</span><br>  <span class="hljs-keyword">public</span> Connection <span class="hljs-title function_">conn</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">Connection</span> <span class="hljs-variable">conn</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">try</span> &#123;<br>      <span class="hljs-type">ConnectionFactoryBean</span> <span class="hljs-variable">factory</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ConnectionFactoryBean</span>();<br>      conn = factory.getObject();<br>    &#125;<span class="hljs-keyword">catch</span>(Exception e)&#123;<br>      e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> conn;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><br><span class="hljs-number">2.</span> 自定义类型注入<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> UserDao <span class="hljs-title function_">userDao</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDaoImpl</span>();<br>&#125;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> UserService <span class="hljs-title function_">userService</span><span class="hljs-params">(UserDao userDao)</span>&#123;<br>  <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>  userService,setUserDao(userDao);<br>  <span class="hljs-keyword">return</span> userService;<br>&#125;<br><br><span class="hljs-comment">//另一种写法</span><br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> UserDao <span class="hljs-title function_">userDao</span><span class="hljs-params">()</span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDaoImpl</span>();<br>&#125;<br><span class="hljs-meta">@Bean</span><br><span class="hljs-keyword">public</span> UserService <span class="hljs-title function_">userService</span><span class="hljs-params">(UserDao userDao)</span>&#123;<br>  <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserServiceImpl</span>();<br>  userService,setUserDao(userDao());<span class="hljs-comment">//直接调用方法</span><br>  <span class="hljs-keyword">return</span> userService;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>底层原理</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">底层通过cglib进行功能增强：如单例/多例模式<br></code></pre></td></tr></table></figure><h3 id="Configuration"><a href="#Configuration" class="headerlink" title="@Configuration "></a><a href="/Configuration">@Configuration</a></h3><blockquote><p>代替 xml 配置形式</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig</span>&#123;&#125;<br><span class="hljs-comment">//此时不再需要xml配置文件，获取ApplicationContext换一种方式</span><br><br><span class="hljs-comment">//指定bean所在路径</span><br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ac</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(AppConfig.class)<br><span class="hljs-comment">//指定bean所在路径</span><br><span class="hljs-type">ApplicationContext</span> <span class="hljs-variable">ac</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationConfigApplicationContext</span>(<span class="hljs-string">&quot;com.lqs.config&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>注意细节</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs markdown">基于注解开发，不能集成 Log4j，使用 logback<br><br>resources 目录下，新建 logback.xml<br></code></pre></td></tr></table></figure><ul><li>@Configuration 本质</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">本质：@Component 注解的衍生注解<br></code></pre></td></tr></table></figure><h3 id="ComponentScan"><a href="#ComponentScan" class="headerlink" title="@ComponentScan "></a><a href="/ComponentScan">@ComponentScan</a></h3><blockquote><p>代替&lt;context:component-scan base-package&#x3D;””&#x2F;&gt;<br>用在@Configuration 注解上面</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.lqs&quot;</span><br><span class="hljs-meta">     useDefaultFilters = false//默认为true，可扫描@Component、@Repository、@Service 和 @Controller 标注的类</span><br><span class="hljs-meta">     excludefilters = &#123;</span><br><span class="hljs-meta">  //排除类型,可叠加使用，一共5种，参考标签形式</span><br><span class="hljs-meta">  //不扫描Service注解</span><br><span class="hljs-meta">  @ComponentScan.Filter(type = Filter.ANNOTATION, value = &#123;Service.class&#125;)</span><br><span class="hljs-meta">  @ComponentScan.Filter(type = Filter.ASPECTJ, pattern = &#123;&quot;com.lqs..*&quot;&#125;)</span><br><span class="hljs-meta">  @ComponentScan.Filter(type = Filter.ASSIGNABLE_TYPE, value = &#123;&#125;)</span><br><span class="hljs-meta">  @ComponentScan.Filter(type = Filter.REGEX, pattern = &#123;&#125;)</span><br><span class="hljs-meta">  @ComponentScan.Filter(type = Filter.CUSTOM, value = &#123;&#125;)</span><br><span class="hljs-meta"></span><br><span class="hljs-meta"></span><br><span class="hljs-meta">&#125;)</span><br></code></pre></td></tr></table></figure><h2 id="6、多配置方式"><a href="#6、多配置方式" class="headerlink" title="6、多配置方式"></a>6、多配置方式</h2><ul><li>配置优先级</li></ul><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">bean 标签 &gt; @Bean &gt; @Component 及衍生注解，可以进行覆盖<br></code></pre></td></tr></table></figure><h2 id="7、整合多个配置信息"><a href="#7、整合多个配置信息" class="headerlink" title="7、整合多个配置信息"></a>7、整合多个配置信息</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs markdown">模块化开发，便于维护<br></code></pre></td></tr></table></figure><ul><li>方式一</li></ul><p>![](&#x2F;Users&#x2F;lqs&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20201119172948238.png)</p><ul><li>方式二</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/FhcOAlRUuENCFZmQHSRX0kwh7TKY.png" srcset="/img/loading.gif" lazyload></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">等价于<span class="hljs-tag">&lt;<span class="hljs-name">import</span> <span class="hljs-attr">resource</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br></code></pre></td></tr></table></figure><ul><li>方式三</li></ul><p>在工厂创建时，指定多个配置 Bean 的 class 对象（了解即可）</p><ul><li>跨配置注入</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@Import(AppConfig2.class)</span><br><span class="hljs-meta">@ImportResouce(&quot;application.xml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig1</span> &#123;<br><br>  <span class="hljs-meta">@Autowired</span><br>  <span class="hljs-keyword">private</span> UserDao userDao;<br><br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-keyword">public</span> userService <span class="hljs-title function_">userService</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">UserService</span> <span class="hljs-variable">userService</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserService</span>();<br>    userService.setUserDao(userDao);<br>    <span class="hljs-keyword">return</span> userService;<br>  &#125;<br>&#125;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppConfig2</span> &#123;<br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-keyword">public</span> userService <span class="hljs-title function_">userService</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDao</span>();<br>  &#125;<br>&#125;<br><br><span class="hljs-comment">//application.xml内容</span><br>&lt;bean id=<span class="hljs-string">&quot;user2&quot;</span> class=<span class="hljs-string">&quot;com.lqs.User2&quot;</span>/&gt;<br></code></pre></td></tr></table></figure><h2 id="8、四维一体开发思想"><a href="#8、四维一体开发思想" class="headerlink" title="8、四维一体开发思想"></a>8、四维一体开发思想</h2><blockquote><p>基于 schema</p><p>基于特定功能注解</p><p>基于原始</p><p>基于@Bean 注解</p></blockquote><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs markdown">例子：<br><br><span class="hljs-bullet">1.</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span>/&gt;</span></span><br><span class="hljs-bullet">2.</span> @PropertySource<br><span class="hljs-bullet">3.</span> <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span></span><br><span class="hljs-bullet">4.</span> @Bean<br></code></pre></td></tr></table></figure><h2 id="9、纯注解-AOP"><a href="#9、纯注解-AOP" class="headerlink" title="9、纯注解 AOP"></a>9、纯注解 AOP</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Aspect</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspect</span>&#123;<br> <span class="hljs-meta">@Around(&quot;execution(* login(..))&quot;)</span><br> <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint jointpoint)</span> <span class="hljs-keyword">throws</span> Throwable&#123;<br>   sout(<span class="hljs-string">&quot;---around-log&quot;</span>);<br>   <span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> jointPoint.proceed();<br>   <span class="hljs-keyword">return</span> ret;<br> &#125;<br>&#125;<br><br>- 配置文件中<br>&lt;aop:aspectj-autoproxy/&gt;<br><span class="hljs-meta">@EnableAspectjAutoProxy</span><br></code></pre></td></tr></table></figure><ul><li>细节分析</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> 代理创建方式的切换：JDK Cglib<br>  &lt;aop:aspectj-autoproxy proxy-target-class=<span class="hljs-literal">true</span> | <span class="hljs-literal">false</span>/&gt;<br>	<span class="hljs-meta">@EnableAspectjAutoProxy(proxyTargetClass)</span><br><span class="hljs-number">2.</span> SpringBoot AOP开发方式<br>	<span class="hljs-meta">@EnableAspectjAutoProxy</span>已经配置好了<br><br>  <span class="hljs-number">1</span>、原始对象<br>  <span class="hljs-meta">@Service</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span>()&#123;<br><br>  &#125;<br>  <span class="hljs-number">2</span>、创建切面类<br>    <span class="hljs-meta">@Aspect</span><br>    <span class="hljs-meta">@Component</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAspect</span> &#123;<br>     	<span class="hljs-meta">@Around(&quot;execution(* login(..))&quot;)</span><br>  		<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">around</span><span class="hljs-params">(ProceedingJoinPoint jointpoint)</span> <span class="hljs-keyword">throws</span> Throwable&#123;<br>    		sout(<span class="hljs-string">&quot;---around-log&quot;</span>);<br>    		<span class="hljs-type">Object</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> jointPoint.proceed();<br>    		<span class="hljs-keyword">return</span> ret;<br>  		&#125;<br>    &#125;<br></code></pre></td></tr></table></figure><h2 id="10、Mybatis-纯注解"><a href="#10、Mybatis-纯注解" class="headerlink" title="10、Mybatis 纯注解"></a>10、Mybatis 纯注解</h2><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/Fs103ej6gqUO0shgb9RilP7DwVfw.png" srcset="/img/loading.gif" lazyload></p><ul><li>MapperLocations 编码通配写法</li></ul><p><img src="https://aries-blog.oss-cn-hangzhou.aliyuncs.com/yuque_hexo/Fqu_roer0mdAfsKbdrfTiHabwsE6.png" srcset="/img/loading.gif" lazyload></p><h2 id="11、纯注解事务编程"><a href="#11、纯注解事务编程" class="headerlink" title="11、纯注解事务编程"></a>11、纯注解事务编程</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> 原始对象 XXXService<br>  	&lt;bean id=<span class="hljs-string">&quot;userService&quot;</span> class=<span class="hljs-string">&quot;com.lqs.service.UserService&quot;</span>&gt;<br>    	&lt;property name=<span class="hljs-string">&quot;userDao&quot;</span> ref=<span class="hljs-string">&quot;userDao&quot;</span>/&gt;<br>  	&lt;/bean&gt;<br><span class="hljs-number">2.</span> 额外功能<br>    &lt;bean class=<span class="hljs-string">&quot;org.springframe.jdbc.dataSource.DataSourceTransactionManager&quot;</span><br>      id=<span class="hljs-string">&quot;dataSourceTransactional&quot;</span>&gt;<br>      &lt;property name=<span class="hljs-string">&quot;dataSource&quot;</span> ref=<span class="hljs-string">&quot;dataSource&quot;</span>/&gt;<br>    &lt;/bean&gt;<br><span class="hljs-number">3.</span> 事务属性<br>  <span class="hljs-meta">@Transactional</span><br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IUserService</span> &#123;<br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>  &#125;<br><span class="hljs-number">4.</span> 基于schema的事务配置<br>  &lt;tx:annotation-driven transaction-manager=<span class="hljs-string">&quot;dataSourceTransactionManager&quot;</span><br></code></pre></td></tr></table></figure><h1 id="十七、Spring-使用-YML"><a href="#十七、Spring-使用-YML" class="headerlink" title="十七、Spring 使用 YML"></a>十七、Spring 使用 YML</h1><blockquote><p>YML(YAML)是一种新形式的配置文件，比 XML 简单，比 properties 更强大</p><p>properties 缺点：</p><p>过于繁琐，无法表达内在联系</p><p>无法表达对象、集合类型</p></blockquote><h2 id="1、语法简介"><a href="#1、语法简介" class="headerlink" title="1、语法简介"></a>1、语法简介</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 1、基本语法</span><br><span class="hljs-attr">name:</span> <span class="hljs-string">lqs</span><br><span class="hljs-attr">password:</span> <span class="hljs-number">123456</span><br><span class="hljs-comment"># 2、对象语法</span><br><span class="hljs-attr">user:</span><br>	<span class="hljs-attr">id:</span> <span class="hljs-number">1</span><br>	<span class="hljs-attr">name:</span> <span class="hljs-string">lqs</span><br>	<span class="hljs-attr">address:</span> <span class="hljs-string">wuhan</span><br><span class="hljs-comment"># 3、定义集合</span><br><span class="hljs-attr">service:</span><br>	<span class="hljs-bullet">-</span> <span class="hljs-number">111</span><br>	<span class="hljs-bullet">-</span> <span class="hljs-number">222</span><br></code></pre></td></tr></table></figure><h2 id="2、Spring-整合-YML"><a href="#2、Spring-整合-YML" class="headerlink" title="2、Spring 整合 YML"></a>2、Spring 整合 YML</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-bullet">1.</span> 准备配置文件 xxx.yml<br>   init: begin<br>   name: lqs<br><span class="hljs-bullet">2.</span> 读取 yml 转换成 properties<br>   YamlPropertiesFactoryBean.setResources(yml 路径)<br>   new ClassPathResource();<br>   YamlPropertiesFactoryBean.getObject() ----&gt; properties<br><span class="hljs-bullet">3.</span> 应用 propertySourcePlaceholderConfigurer<br>   PropertySourcePlaceholderConfigurer.setProperties();<br></code></pre></td></tr></table></figure><h2 id="3、Spring-与-YML-集成编码"><a href="#3、Spring-与-YML-集成编码" class="headerlink" title="3、Spring 与 YML 集成编码"></a>3、Spring 与 YML 集成编码</h2><ul><li>环境搭建</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.yml<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>snakeyaml<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.23<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><span class="hljs-comment">&lt;!--最低1.18--&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>编码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">2.</span> 配置bean完成yml读取与PropertySourcePlacrholderConfigurer的创建<br><span class="hljs-meta">@Configuration</span><br><span class="hljs-meta">@ComponentScan(basePackages = &quot;com.lqs.yml&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YmlAutoConfiguration</span>&#123;<br>  <span class="hljs-meta">@Bean</span><br>  <span class="hljs-keyword">public</span> PropertySourcePlacrholderConfigurer <span class="hljs-title function_">configure</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">YamlPropertySourceFactoryBean</span> <span class="hljs-variable">ymlbean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">YamlPropertySourceFactoryBean</span>();<br>    ymlBean.setResources(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">&quot;xxx.yml&quot;</span>))<br>    <span class="hljs-type">Properties</span> <span class="hljs-variable">properties</span> <span class="hljs-operator">=</span> yamlPropertiesFactoryBean.getObject();<br>    <span class="hljs-type">PropertySourcePlacrholderConfigurer</span> <span class="hljs-variable">configurer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PropertySourcePlacrholderConfigurer</span>();<br>    configurer.setProperties(properties);<br>    <span class="hljs-keyword">return</span> configurer;<br>  &#125;<br>&#125;<br><br><span class="hljs-number">3.</span> 类加入<span class="hljs-meta">@Value</span>注解<br><span class="hljs-meta">@Value(&quot;$&#123;account.name&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String name;<br></code></pre></td></tr></table></figure><h2 id="4、注意的问题"><a href="#4、注意的问题" class="headerlink" title="4、注意的问题"></a>4、注意的问题</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 1、集合处理的问题</span><br><span class="hljs-comment"># SpringEL表达式解决</span><br><span class="hljs-attr">list:</span><br>	<span class="hljs-number">111</span><span class="hljs-string">,2222</span><br><span class="hljs-string">@Value(&quot;#&#123;&#x27;$&#123;list&#125;&#x27;.split(&#x27;,&#x27;)&#125;&quot;)</span><br><br><span class="hljs-comment"># 2、对象类型配置太繁琐</span><br><span class="hljs-attr">account:</span><br>	<span class="hljs-attr">name:</span> <span class="hljs-string">lqs</span><br>	<span class="hljs-attr">age:</span> <span class="hljs-number">18</span><br><span class="hljs-string">@Value(&quot;$&#123;account.name&#125;&quot;)</span><br><span class="hljs-string">private</span> <span class="hljs-string">String</span> <span class="hljs-string">name;</span><br><br><span class="hljs-string">@Value(&quot;$&#123;account.age&#125;&quot;);</span><br><span class="hljs-string">private</span> <span class="hljs-string">int</span> <span class="hljs-string">age;</span><br><br><span class="hljs-comment"># SpringBoot定义@ConfigurationProperties注解解决该问题</span><br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/Spring/" class="category-chain-item">Spring</a></span></span></div></div><div class="license-box my-3"><div class="license-title"><div>Spring5</div><div>https://polarisink.github.io/20220813/yuque/Spring5/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Areis</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2022年8月13日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/20220813/yuque/Docker%E9%83%A8%E7%BD%B2MySQL/" title="Docker部署MySQL"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">Docker部署MySQL</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/20220813/yuque/RabbitMQ%E6%95%99%E7%A8%8B/" title="RabbitMQ教程"><span class="hidden-mobile">RabbitMQ教程</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="giscus" class="giscus"></div><script type="text/javascript">Fluid.utils.loadComments('#giscus', function() {
        var options = {"repo":"polarisink/polarisink","repo-id":"R_kgDOGg565Q","category":"Announcements","category-id":"DIC_kwDOGg565c4CVIbD","theme-light":"light","theme-dark":"dark","mapping":"title","reactions-enabled":1,"emit-metadata":0,"input-position":"top","lang":"zh-CN"};
        var attributes = {};
        for (let option in options) {
          if (!option.startsWith('theme-')) {
            var key = option.startsWith('data-') ? option : 'data-' + option;
            attributes[key] = options[option];
          }
        }
        var light = 'light';
        var dark = 'dark';
        window.GiscusThemeLight = light;
        window.GiscusThemeDark = dark;
        attributes['data-theme'] = document.documentElement.getAttribute('data-user-color-scheme') === 'dark' ? dark : light;
        for (let attribute in attributes) {
          var value = attributes[attribute];
          if (value === undefined || value === null || value === '') {
            delete attributes[attribute];
          }
        }
        var s = document.createElement('script');
        s.setAttribute('src', 'https://giscus.app/client.js');
        s.setAttribute('crossorigin', 'anonymous');
        for (let attribute in attributes) {
          s.setAttribute(attribute, attributes[attribute]);
        }
        var ss = document.getElementsByTagName('script');
        var e = ss.length > 0 ? ss[ss.length - 1] : document.head || document.documentElement;
        e.parentNode.insertBefore(s, e.nextSibling);
      });</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t){var e=Fluid.plugins.typing,i=t.getElementById("subtitle");i&&e&&e(i.getAttribute("data-typed-text"))}((window,document))</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>