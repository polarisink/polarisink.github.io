

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Areis">
  <meta name="keywords" content="">
  
    <meta name="description" content="Elasticsearch 是一个基于Apache Lucene(TM)的开源搜索引擎。无论在开源还是专有领域，Lucene 可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。">
<meta property="og:type" content="article">
<meta property="og:title" content="ElasticSearch">
<meta property="og:url" content="https://polarisink.github.io/2022/08/13/yuque/ElasticSearch/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Elasticsearch 是一个基于Apache Lucene(TM)的开源搜索引擎。无论在开源还是专有领域，Lucene 可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://images.unsplash.com/photo-1665238076980-47731fc833b2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxlZGl0b3JpYWwtZmVlZHwxNHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=60">
<meta property="article:published_time" content="2022-08-13T13:41:15.000Z">
<meta property="article:modified_time" content="2022-10-14T03:22:59.158Z">
<meta property="article:author" content="Areis">
<meta property="article:tag" content="ES">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1665238076980-47731fc833b2?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxlZGl0b3JpYWwtZmVlZHwxNHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=60">
  
  
  
  <title>ElasticSearch - Hexo</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"polarisink.github.io","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>北辰的笔墨</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="ElasticSearch"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-08-13 21:41" pubdate>
          2022年8月13日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          23k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          192 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">ElasticSearch</h1>
            
            
              <div class="markdown-body">
                
                <p>Elasticsearch 是一个基于<a target="_blank" rel="noopener" href="https://lucene.apache.org/core/">Apache Lucene(TM)</a>的开源搜索引擎。无论在开源还是专有领域，Lucene 可以被认为是迄今为止最先进、性能最好的、功能最全的搜索引擎库。</p>
<span id="more"></span>

<h1 id="一、基本概念"><a href="#一、基本概念" class="headerlink" title="一、基本概念"></a>一、基本概念</h1><h2 id="1、Index-索引"><a href="#1、Index-索引" class="headerlink" title="1、Index(索引)"></a>1、Index(索引)</h2><blockquote>
<p>类比 MySQL 的数据库</p>
</blockquote>
<h2 id="2、Type-类型"><a href="#2、Type-类型" class="headerlink" title="2、Type(类型)"></a>2、Type(类型)</h2><blockquote>
<p>类比 MySQL 的数据表</p>
</blockquote>
<h2 id="3、Document-文件"><a href="#3、Document-文件" class="headerlink" title="3、Document(文件)"></a>3、Document(文件)</h2><blockquote>
<p>类比 MySQL 的数据</p>
</blockquote>
<h2 id="4、倒排索引机制"><a href="#4、倒排索引机制" class="headerlink" title="4、倒排索引机制"></a>4、倒排索引机制</h2><h1 id="二、Docker-安装"><a href="#二、Docker-安装" class="headerlink" title="二、Docker 安装"></a>二、Docker 安装</h1><h2 id="1、下载镜像文件"><a href="#1、下载镜像文件" class="headerlink" title="1、下载镜像文件"></a>1、下载镜像文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">存储和检索数据</span><br>docker pull elasticsearch:7.4.2<br><span class="hljs-meta prompt_"># </span><span class="language-bash">可视化检索数据</span><br>docker pull kibana:7.4.2<br></code></pre></td></tr></table></figure>

<h2 id="2、创建实例"><a href="#2、创建实例" class="headerlink" title="2、创建实例"></a>2、创建实例</h2><ul>
<li>启动 ElasticSearch</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">mkdir -p <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch/config<br>mkdir -p <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch/data<br>echo <span class="hljs-string">&quot;http.host: 0.0.0.0&quot;</span> &gt; <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/config/</span>elasticsearch.yml<br>chmod -R <span class="hljs-number">777</span> <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch/<br><br>docker run --name elasticsearch -p <span class="hljs-number">9200</span>:<span class="hljs-number">9200</span> -p <span class="hljs-number">9300</span>:<span class="hljs-number">9300</span> \<br>-e  <span class="hljs-string">&quot;discovery.type=single-node&quot;</span> \<br>-e ES_JAVA_OPTS=<span class="hljs-string">&quot;-Xms64m -Xmx512m&quot;</span> \<br>-v <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/config/</span>elasticsearch.yml:<span class="hljs-regexp">/usr/</span>share<span class="hljs-regexp">/elasticsearch/</span>config/elasticsearch.yml \<br>-v <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/data:/u</span>sr<span class="hljs-regexp">/share/</span>elasticsearch/data \<br>-v  <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>elasticsearch<span class="hljs-regexp">/plugins:/u</span>sr<span class="hljs-regexp">/share/</span>elasticsearch/plugins \<br>-d elasticsearch:<span class="hljs-number">7.4</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动 kibana</li>
</ul>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment"># ELASTICSEARCH_HOSTS一定虚拟机的host</span><br><span class="hljs-attribute">docker</span> run --name kibana -e ELASTICSEARCH_HOSTS=http://localhost:<span class="hljs-number">9200</span> -p <span class="hljs-number">5601</span>:<span class="hljs-number">5601</span> -d kibana:<span class="hljs-number">7</span>.<span class="hljs-number">4</span>.<span class="hljs-number">2</span><br><br><span class="hljs-comment"># 或者此方法，但要记住先启动es再启动kibana</span><br><span class="hljs-attribute">docker</span> run -d --name kibana --link elasticsearch -p <span class="hljs-number">5601</span>:<span class="hljs-number">5601</span> kibana:<span class="hljs-number">7</span>.<span class="hljs-number">4</span>.<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>

<ul>
<li>设置开机启动</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker update elasticsearch --restart=always<br>docker update kibana  --restart=always<br></code></pre></td></tr></table></figure>

<h1 id="三、初步探索"><a href="#三、初步探索" class="headerlink" title="三、初步探索"></a>三、初步探索</h1><h2 id="1、-cat"><a href="#1、-cat" class="headerlink" title="1、_cat"></a>1、_cat</h2><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 查看所有节点</span><br><span class="hljs-built_in">GET</span> /_cat/nodes<br><span class="hljs-comment"># 查看es健康情况</span><br><span class="hljs-built_in">GET</span> /_cat<span class="hljs-built_in">/health</span><br><span class="hljs-built_in"></span><span class="hljs-comment"># 查看主节点</span><br><span class="hljs-built_in">GET</span> /_cat/master<br><span class="hljs-comment"># 查看所有索引</span><br><span class="hljs-built_in">GET</span> /_cat/indices<br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/Fohsw7OX1aZhjkVUjoSwYwMYdfAu.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2、索引一个文档"><a href="#2、索引一个文档" class="headerlink" title="2、索引一个文档"></a>2、索引一个文档</h2><ul>
<li>保存一个数据，保存在哪个索引的哪个类型下，指定用那个唯一标识<br>PUT customer&#x2F;external&#x2F;1;在 customer 索引下的 external 类型下保存 1 号数据为</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">PUT customer<span class="hljs-regexp">/external/</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br> <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;John Doe&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>PUT 和 POST 对比<table>
<thead>
<tr>
<th>项目</th>
<th>功能</th>
<th>id</th>
<th>一般用途</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>新增</td>
<td>可以不指定</td>
<td>新增</td>
</tr>
<tr>
<td>PUT</td>
<td>新增&#x2F;修改</td>
<td>必须指定</td>
<td>修改</td>
</tr>
</tbody></table>
</li>
</ul>
<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/Fkx5yJ8LHbY7fylPF8vR6jDg09Sb.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># _前缀表示他为元数据</span><br>&#123;<br>    <span class="hljs-meta"># 表明该数据在customer数据库下</span><br>    <span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;customer&quot;</span>,<br>    <span class="hljs-meta"># 表明类型</span><br>    <span class="hljs-string">&quot;_type&quot;</span>: <span class="hljs-string">&quot;external&quot;</span>,<br>    <span class="hljs-meta"># id值</span><br>    <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>    <span class="hljs-meta"># 版本，修改之后升级</span><br>    <span class="hljs-string">&quot;_version&quot;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-meta"># 创建时返回created，修改时返回updated</span><br>    <span class="hljs-string">&quot;result&quot;</span>: <span class="hljs-string">&quot;created&quot;</span>,<br>    <span class="hljs-string">&quot;_shards&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;total&quot;</span>: <span class="hljs-number">2</span>,<br>        <span class="hljs-string">&quot;successful&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;failed&quot;</span>: <span class="hljs-number">0</span><br>    &#125;,<br>    <span class="hljs-string">&quot;_seq_no&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-string">&quot;_primary_term&quot;</span>: <span class="hljs-number">1</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3、查看文档"><a href="#3、查看文档" class="headerlink" title="3、查看文档"></a>3、查看文档</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">GET <span class="hljs-regexp">/customer/</span>external/<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/Fsg250SkNXMktxqBkaZOtlb4SmHv.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs applescript">&#123;<br>	<span class="hljs-string">&quot;_index&quot;</span>: <span class="hljs-string">&quot;customer&quot;</span>,<br>	<span class="hljs-string">&quot;_type&quot;</span>: <span class="hljs-string">&quot;external&quot;</span>,<br>	<span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;1&quot;</span>,<br>	<span class="hljs-string">&quot;_version&quot;</span>: <span class="hljs-number">1</span>,<br>	<span class="hljs-comment"># 并发控制字段，每次更新+1，做乐观锁</span><br>	<span class="hljs-string">&quot;_seq_no&quot;</span>: <span class="hljs-number">0</span>,<br>	<span class="hljs-comment"># 同上，主分片重新分配，如重启就会变化</span><br>	<span class="hljs-string">&quot;_primary_term&quot;</span>: <span class="hljs-number">1</span>,<br>	<span class="hljs-string">&quot;found&quot;</span>: <span class="hljs-literal">true</span>,<br>	<span class="hljs-string">&quot;_source&quot;</span>: &#123;<br>		<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;John Doe&quot;</span><br>	&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4、更新文档"><a href="#4、更新文档" class="headerlink" title="4、更新文档"></a>4、更新文档</h2><ul>
<li>三种实现</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 方法一：post带update</span><br><span class="hljs-comment"># 需要doc标签，数据无变化不操作，version不更新，result为noop(no operation)</span><br>POST customer<span class="hljs-regexp">/external/</span><span class="hljs-number">1</span>/_update<br>&#123;<br>    <span class="hljs-string">&quot;doc&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;John Doew&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment"># 方法二：post不带update</span><br><span class="hljs-comment"># 不需要doc，重复执行更新也能成功，也version会更新</span><br>POST customer<span class="hljs-regexp">/external/</span><span class="hljs-number">1</span><br>&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;John Doew2&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 方法三：put操作（不存在带update的情况）</span><br><span class="hljs-comment"># 更新，不管是否有变化，version都会增加</span><br><span class="hljs-comment">#</span><br>PUT customer<span class="hljs-regexp">/external/</span><span class="hljs-number">1</span><br>&#123;<br>    <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;John Doew3&quot;</span><br>&#125;<br><br><span class="hljs-comment"># 更新同时增加属性</span><br>POST customer<span class="hljs-regexp">/external/</span><span class="hljs-number">1</span>/_update<br>&#123;<br>    <span class="hljs-string">&quot;doc&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;John Doew4&quot;</span>,<br>	<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">20</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>对比<ul>
<li>POST 会对比原文件数据，相同不会有操作，version 不增加</li>
<li>PUT 总会更新数据且增加 version 字段</li>
<li>带_update 对比原数据一样就不进行任何操作</li>
<li>使用场景： - 大并发更新：不带 update - 大并发查询偶尔更新，带 update；对比更新，重新计算分配规则<table>
<thead>
<tr>
<th></th>
<th>带 update</th>
<th>不带 update</th>
</tr>
</thead>
<tbody><tr>
<td>POST</td>
<td>body 带 doc 标签</td>
<td></td>
</tr>
<tr>
<td>PUT</td>
<td></td>
<td></td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
<h2 id="5、删除文档或索引"><a href="#5、删除文档或索引" class="headerlink" title="5、删除文档或索引"></a>5、删除文档或索引</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">DELETE</span> customer<span class="hljs-regexp">/external/</span><span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">DELETE customer</span><br></code></pre></td></tr></table></figure>

<p>注：<strong>elasticsearch 并没有提供删除类型的操作，只提供了删除索引和文档的操作</strong></p>
<h2 id="6、bulk-批量-API"><a href="#6、bulk-批量-API" class="headerlink" title="6、bulk 批量 API"></a>6、bulk 批量 API</h2><ul>
<li>语法</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs awk">POST customer<span class="hljs-regexp">/external/</span>_bulk<br><span class="hljs-comment"># 元数据</span><br>&#123;action:&#123;metadata&#125;&#125;<br><span class="hljs-comment"># 具体数据</span><br>&#123;request body  &#125;<br><br>&#123;action:&#123;metadata&#125;&#125;<br>&#123;request body&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>例子</li>
</ul>
<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/Fmh7yyND1x5EaLMBJWC0LM6KrHHX.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>规则</li>
</ul>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs markdown">批量操作，彼此之间是独立:当发生某一条执行发生失败时，其他的数据仍然能够接着执行.<br>bulkapi 以此按顺序执行所有的 action（动作）。<br>如果一个单个的动作因任何原因失败，它将继续处理它后面剩余的动作。<br>当 bulk api 返回时，它将提供每个动作的状态（与发送的顺序相同），可以检查是否一个指定的动作是否失败了。<br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/Fs61AX2VGvKV0fHEJFYa0s6udqaE.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="7、样本测试数据"><a href="#7、样本测试数据" class="headerlink" title="7、样本测试数据"></a>7、样本测试数据</h2><p><a target="_blank" rel="noopener" href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json?raw=true">测试数据</a>，将所有数据保存，基于此进行测试</p>
<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FmoQqBjCPGECB9wRMfHdrw8zlRxr.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="四、进阶检索"><a href="#四、进阶检索" class="headerlink" title="四、进阶检索"></a>四、进阶检索</h1><h2 id="1、Search-API"><a href="#1、Search-API" class="headerlink" title="1、Search API"></a>1、Search API</h2><h3 id="1、检索信息"><a href="#1、检索信息" class="headerlink" title="1、检索信息"></a>1、检索信息</h3><p>ES 支持两种基本方式检索；</p>
<ul>
<li>通过 REST request uri 发送搜索参数 （uri +检索参数）；</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> bank/_search/?<span class="hljs-attribute">q</span>=*&amp;sort=account_number:asc<br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FofEQpqKNNfyn8gmX6W7asql9b4F.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs markdown">took:执行时间<br>time<span class="hljs-emphasis">_out:是否超时</span><br><span class="hljs-emphasis">\_</span>shards:被搜索的分片数量<br>hits:搜索结果<br>hits.total:搜索结果<br>hits.hits:实际的搜索结果数组<br>sort:结果排序的 key<br>score:相关性得分<br>max<span class="hljs-emphasis">_score:最高得分</span><br></code></pre></td></tr></table></figure>

<ul>
<li>通过 REST request body 来发送它们（uri+请求体）；</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;account_number&quot;</span>: <span class="hljs-string">&quot;asc&quot;</span><br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/Fhzgj6I0Ed-2ZEfJ_d62uUuEfdAj.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="2、Query-DSL"><a href="#2、Query-DSL" class="headerlink" title="2、Query DSL"></a>2、Query DSL</h2><h3 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h3><blockquote>
<p>Elasticsearch 提供了一个可以执行查询的 JSON 风格的 DSL。这个被称为 Query DSL，该查询语言非常全面。</p>
</blockquote>
<ul>
<li>一个查询语句的典型结构</li>
</ul>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">QUERY_NAME:</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">   ARGUMENT:</span>VALUE,<br><span class="hljs-symbol">   ARGUMENT:</span>VALUE,...<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">  QUERY_NAME:</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">     FIELD_NAME:</span><span class="hljs-punctuation">&#123;</span><br><span class="hljs-symbol">       ARGUMENT:</span>VALUE,<br><span class="hljs-symbol">       ARGUMENT:</span>VALUE,...<br>      <span class="hljs-punctuation">&#125;</span>  <br>   <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET bank/_search<br>&#123;<br>  <span class="hljs-comment"># 查询规则</span><br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-comment"># 分页规则，从哪开始，页码大小</span><br>  <span class="hljs-string">&quot;from&quot;</span>: 0,<br>  <span class="hljs-string">&quot;size&quot;</span>: 5,<br>  <span class="hljs-comment"># 排序规则</span><br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;account_number&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>      &#125;<br>    &#125;<br>  ]<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>match_all 查询类型【代表查询所有的所有】，es 中可以在 query 中组合非常多的查询类型完成复杂查询；</li>
<li>除了 query 参数之外，我们可也传递其他的参数以改变查询结果，如 sort，size；</li>
<li>from+size 限定，完成分页功能；</li>
<li>sort 排序，多字段排序，会在前序字段相等时后续字段内部排序，否则以前序为准；</li>
</ul>
<h3 id="2、返回部分"><a href="#2、返回部分" class="headerlink" title="2、返回部分"></a>2、返回部分</h3><ul>
<li>规则</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">GET bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_all&quot;</span>: &#123;&#125;<br>  &#125;,<br>  <span class="hljs-string">&quot;from&quot;</span>: 0,<br>  <span class="hljs-string">&quot;size&quot;</span>: 5,<br>  <span class="hljs-string">&quot;sort&quot;</span>: [<br>    &#123;<br>      <span class="hljs-string">&quot;account_number&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;order&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>      &#125;<br>    &#125;<br>  ],<br>  <span class="hljs-comment"># 返回，直接指定需要返回的字段</span><br>  <span class="hljs-string">&quot;_source&quot;</span>: [<span class="hljs-string">&quot;balance&quot;</span>,<span class="hljs-string">&quot;firstname&quot;</span>]<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>例子</li>
</ul>
<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FraO_9HSmMUu4wRZICS-1oY76gS6.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="3、match-匹配查询"><a href="#3、match-匹配查询" class="headerlink" title="3、match - 匹配查询"></a>3、match - 匹配查询</h3><blockquote>
<p>全文检索，按照评分进行排序，依赖倒排索引</p>
</blockquote>
<ul>
<li>语法</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># match匹配字符串，可以做模糊查询</span><br><span class="hljs-comment"># match匹配数值，为精确查询</span><br><br><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    # 满足<span class="hljs-attribute">account_number</span>=20的<br>    <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;account_number&quot;</span>: 20<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>例子</li>
</ul>
<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FjBFJQ2LRN7XWzPwtsA9gsu0k_LC.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="4、match-phrase-短句匹配"><a href="#4、match-phrase-短句匹配" class="headerlink" title="4、match_phrase - 短句匹配"></a>4、match_phrase - 短句匹配</h3><blockquote>
<p>将需要匹配的值当成一整个单词（不分词）进行检索。</p>
<p>文本字段的匹配，使用 keyword，匹配的条件就是要显示字段的全部值，要进行精确匹配的。</p>
<p>match_phrase 是做短语匹配，只要文本中包含匹配条件，就能匹配到。</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;match_phrase&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;mill road&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="5、multi-match-多字段匹配"><a href="#5、multi-match-多字段匹配" class="headerlink" title="5、multi_match - 多字段匹配"></a>5、multi_match - 多字段匹配</h3><blockquote>
<p>从几个字段中查询，相当于多个 match 叠加，会进行分词</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 从state和address中分词查询mill</span><br><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;multi_match&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;query&quot;</span>: <span class="hljs-string">&quot;mill&quot;</span>,<br>      <span class="hljs-string">&quot;fields&quot;</span>: [<br>        <span class="hljs-string">&quot;state&quot;</span>,<br>        <span class="hljs-string">&quot;address&quot;</span><br>      ]<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="6、bool-复合查询"><a href="#6、bool-复合查询" class="headerlink" title="6、bool - 复合查询"></a>6、bool - 复合查询</h3><blockquote>
<p>复合查询，即可以进行嵌套，实现复杂的逻辑</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># must：必须达到must所列举的所有条件</span><br><span class="hljs-comment"># must_not，必须不匹配must_not所列举的所有条件。</span><br><span class="hljs-comment"># should，应该满足should所列举的条件。如果到达会增加相关文档的评分，并不会改变查询的</span><br><span class="hljs-comment"># 结果。如果query中只有should且只有一种匹配规则，那么should的条件就会被作为默认匹配</span><br><span class="hljs-comment"># 条件二区改变查询结果。</span><br><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>   <span class="hljs-string">&quot;query&quot;</span>:&#123;<br>        <span class="hljs-string">&quot;bool&quot;</span>:&#123;<br>             <span class="hljs-string">&quot;must&quot;</span>:[<br>              &#123;<span class="hljs-string">&quot;match&quot;</span>:&#123;<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;mill&quot;</span>&#125;&#125;,<br>              &#123;<span class="hljs-string">&quot;match&quot;</span>:&#123;<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>&#125;&#125;<br>             ]<br>         &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="7、filter-结果过滤"><a href="#7、filter-结果过滤" class="headerlink" title="7、filter - 结果过滤"></a>7、filter - 结果过滤</h3><blockquote>
<p>对结果进行过滤，相当于 MySQL 的<code>having</code>。使用时不计算相关性得分。</p>
<p>并不是所有的查询都需要产生分数，特别是哪些仅用于 filtering 过滤的文档。为了不计算分数，elasticsearch 会自动检查场景并且优化查询的执行。</p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-comment"># 这里先是查询所有匹配address=mill的文档。</span><br><span class="hljs-comment"># 然后再根据10000&lt;=balance&lt;=20000进行过滤查询结果</span><br><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;bool&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;must&quot;</span>: [<br>        &#123;<br>          <span class="hljs-string">&quot;match&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;mill&quot;</span><br>          &#125;<br>        &#125;<br>      ],<br>      <span class="hljs-string">&quot;filter&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;range&quot;</span>: &#123;<br>          <span class="hljs-string">&quot;balance&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;gte&quot;</span>: <span class="hljs-string">&quot;10000&quot;</span>,<br>            <span class="hljs-string">&quot;lte&quot;</span>: <span class="hljs-string">&quot;20000&quot;</span><br>          &#125;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>Each <code>must</code>, <code>should</code>, and <code>must_not</code> element in a Boolean query is referred to as a query clause. How well a document meets the criteria in each <code>must</code> or <code>should</code> clause contributes to the document’s <em>relevance score</em>. The higher the score, the better the document matches your search criteria. By default, Elasticsearch returns documents ranked by these relevance scores.</p>
<p>在 boolean 查询中，<code>must</code>, <code>should</code> 和<code>must_not</code> 元素都被称为查询子句 。 文档是否符合每个“must”或“should”子句中的标准，决定了文档的“相关性得分”。   得分越高，文档越符合您的搜索条件。   默认情况下，Elasticsearch 返回根据这些相关性得分排序的文档。</p>
<p>The criteria in a <code>must_not</code> clause is treated as a <em>filter</em>. It affects whether or not the document is included in the results, but does not contribute to how documents are scored. You can also explicitly specify arbitrary filters to include or exclude documents based on structured data.</p>
<p><code>“must_not”子句中的条件被视为“过滤器”。</code> 它影响文档是否包含在结果中，   但不影响文档的评分方式。   还可以显式地指定任意过滤器来包含或排除基于结构化数据的文档。</p>
</blockquote>
<h3 id="8、term-匹配查询"><a href="#8、term-匹配查询" class="headerlink" title="8、term - 匹配查询"></a>8、term - 匹配查询</h3><blockquote>
<p>和 match 一样。匹配某个属性的值。<strong>全文检索字段用 match，其他非 text 字段匹配用 term。</strong></p>
</blockquote>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> bank/_search<br>&#123;<br>  <span class="hljs-string">&quot;query&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;term&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">&quot;mill Road&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="9、aggregation-执行聚合"><a href="#9、aggregation-执行聚合" class="headerlink" title="9、aggregation - 执行聚合"></a>9、aggregation - 执行聚合</h3><blockquote>
<p>从数据中分组和提取数据。</p>
<p>最简单的聚合方法大致等于 SQL Group by 和 SQL 聚合函数。在 elasticsearch 中，执行搜索返回 this（命中结果），并且同时返回聚合结果，把以响应中的所有 hits（命中结果）分隔开的能力。这是非常强大且有效的，你可以执行查询和多个聚合，并且在一次使用中得到各自的（任何一个的）返回结果，使用一次简洁和简化的 API 啦避免网络往返。</p>
</blockquote>
<h2 id="3、Mapping"><a href="#3、Mapping" class="headerlink" title="3、Mapping"></a>3、Mapping</h2><h3 id="1、字段类型"><a href="#1、字段类型" class="headerlink" title="1、字段类型"></a>1、字段类型</h3><p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FguJfHPkZ7dzBZkhXWZLFMnbzHq9.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="2、映射"><a href="#2、映射" class="headerlink" title="2、映射"></a>2、映射</h3><blockquote>
<p>Maping 是用来定义一个文档（document），以及它所包含的属性（field）是如何存储和索引的</p>
</blockquote>
<h3 id="3、新版本改变"><a href="#3、新版本改变" class="headerlink" title="3、新版本改变"></a>3、新版本改变</h3><h4 id="创建映射"><a href="#创建映射" class="headerlink" title="创建映射"></a>创建映射</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">PUT /my_index<br>&#123;<br>  <span class="hljs-string">&quot;mappings&quot;</span>: &#123;<br>    <span class="hljs-string">&quot;properties&quot;</span>: &#123;<br>      <span class="hljs-string">&quot;age&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;integer&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;email&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;keyword&quot;</span>&#125;,<br>      <span class="hljs-string">&quot;name&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;text&quot;</span>&#125;<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FoakU_gLWXz79c4c26JPkNwHCAs4.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="查看映射"><a href="#查看映射" class="headerlink" title="查看映射"></a>查看映射</h4><p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FlcYSjHqaKM2bzvLQV4OMJQBiwfT.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="添加新字段映射"><a href="#添加新字段映射" class="headerlink" title="添加新字段映射"></a>添加新字段映射</h4><p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FsQfqDb98HCLdQFh8Pxj7Z7Zl1QJ.png" srcset="/img/loading.gif" lazyload></p>
<h4 id="更新映射"><a href="#更新映射" class="headerlink" title="更新映射"></a>更新映射</h4><p>对于已经存在的字段映射，我们不能更新。更新必须创建新的索引，进行数据迁移。</p>
<h4 id="数据迁移"><a href="#数据迁移" class="headerlink" title="数据迁移"></a>数据迁移</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs css">POST _reindex <span class="hljs-selector-attr">[固定写法]</span><br>&#123;<br>  &quot;source&quot;:&#123;<br>      &quot;index&quot;:<span class="hljs-string">&quot;twitter&quot;</span>,<br>      <span class="hljs-string">&quot;twitter&quot;</span>:<span class="hljs-string">&quot;twitter&quot;</span><br>   &#125;,<br>  &quot;dest&quot;:&#123;<br>      &quot;index&quot;:<span class="hljs-string">&quot;new_twitters&quot;</span><br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>更多详情见： <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/docs-reindex.html">数据迁移</a></p>
<h2 id="4、分词"><a href="#4、分词" class="headerlink" title="4、分词"></a>4、分词</h2><blockquote>
<p>一个 tokenizer（分词器）接收一个字符流，将之分割为独立的 tokens（词元，通常是独立的单词），然后输出 tokens 流。</p>
<p>例如：whitespace tokenizer 遇到空白字符时分割文本。它会将文本“Quick brown fox!”分割为[Quick,brown,fox!]。</p>
<p>该 tokenizer（分词器）还负责记录各个 terms(词条)的顺序或 position 位置（用于 phrase 短语和 word proximity 词近邻查询），以及 term（词条）所代表的原始 word（单词）的 start（起始）和 end（结束）的 character offsets（字符串偏移量）（用于高亮显示搜索的内容）。</p>
<p>elasticsearch 提供了很多内置的分词器，可以用来构建 custom analyzers（自定义分词器）。</p>
<p>关于分词器： <a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.6/analysis.html">分词器</a></p>
</blockquote>
<ul>
<li>使用</li>
</ul>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs fsharp">POST <span class="hljs-keyword">_analyze</span><br>&#123;<br>  <span class="hljs-string">&quot;analyzer&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;standard&quot;</span>,<br>  <span class="hljs-string">&quot;text&quot;</span><span class="hljs-operator">:</span> <span class="hljs-string">&quot;The 2 QUICK Brown-Foxes jumped over the lazy dog&#x27;s bone.&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="1、安装-ik-分词器"><a href="#1、安装-ik-分词器" class="headerlink" title="1、安装 ik 分词器"></a>1、安装 ik 分词器</h3><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs coffeescript"><span class="hljs-comment"># 注意和es版本对应</span><br>[root@server1 elasticsearch]<span class="hljs-comment"># wget https://github.com/medcl/elasticsearch-analysis-ik/releases/download/v7.4.2/elasticsearch-analysis-ik-7.4.2.zip</span><br>[root@server1 elasticsearch]<span class="hljs-comment"># unzip elasticsearch-analysis-ik-7.4.2.zip -d ik</span><br>[root@server1 elasticsearch]<span class="hljs-comment"># mv ik plugins/</span><br>[root@server1 elasticsearch]<span class="hljs-comment"># docker restart elasticsearch kibana</span><br></code></pre></td></tr></table></figure>

<h3 id="2、测试"><a href="#2、测试" class="headerlink" title="2、测试"></a>2、测试</h3><ul>
<li>使用默认分词器</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> my_index/_analyze<br>&#123;<br>   <span class="hljs-string">&quot;text&quot;</span>:<span class="hljs-string">&quot;我是中国人&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : &quot;我&quot;,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 1,<br>      <span class="hljs-string">&quot;type&quot;</span> : &quot;&lt;<span class="hljs-type">IDEOGRAPHIC</span>&gt;<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 0</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>是<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 1,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>&lt;IDEOGRAPHIC&gt;<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 1</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>中<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 3,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>&lt;IDEOGRAPHIC&gt;<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 2</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>国<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 3,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 4,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>&lt;IDEOGRAPHIC&gt;<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 3</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>人<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 4,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 5,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>&lt;IDEOGRAPHIC&gt;<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 4</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>使用智能分词器</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> my_index/_analyze<br>&#123;<br>   <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_smart&quot;</span>,<br>   <span class="hljs-string">&quot;text&quot;</span>:<span class="hljs-string">&quot;我是中国人&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : &quot;我&quot;,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 1,<br>      <span class="hljs-string">&quot;type&quot;</span> : &quot;<span class="hljs-type">CN_CHAR</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 0</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>是<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 1,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>CN_CHAR<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 1</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>中国人<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 5,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>CN_WORD<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 2</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>使用 max 分词器</li>
</ul>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">GET</span> my_index/_analyze<br>&#123;<br>   <span class="hljs-string">&quot;analyzer&quot;</span>: <span class="hljs-string">&quot;ik_max_word&quot;</span>,<br>   <span class="hljs-string">&quot;text&quot;</span>:<span class="hljs-string">&quot;我是中国人&quot;</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs ada">&#123;<br>  <span class="hljs-string">&quot;tokens&quot;</span> : [<br>    &#123;<br>      <span class="hljs-string">&quot;token&quot;</span> : &quot;我&quot;,<br>      <span class="hljs-string">&quot;start_offset&quot;</span> : 0,<br>      <span class="hljs-string">&quot;end_offset&quot;</span> : 1,<br>      <span class="hljs-string">&quot;type&quot;</span> : &quot;<span class="hljs-type">CN_CHAR</span><span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 0</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>是<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 1,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>CN_CHAR<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 1</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>中国人<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 5,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>CN_WORD<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 2</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>中国<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 2,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 4,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>CN_WORD<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 3</span><br><span class="hljs-string">    &#125;,</span><br><span class="hljs-string">    &#123;</span><br><span class="hljs-string">      &quot;</span>token<span class="hljs-string">&quot; : &quot;</span>国人<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>start_offset<span class="hljs-string">&quot; : 3,</span><br><span class="hljs-string">      &quot;</span>end_offset<span class="hljs-string">&quot; : 5,</span><br><span class="hljs-string">      &quot;</span><span class="hljs-keyword">type</span><span class="hljs-string">&quot; : &quot;</span>CN_WORD<span class="hljs-string">&quot;,</span><br><span class="hljs-string">      &quot;</span>position<span class="hljs-string">&quot; : 4</span><br><span class="hljs-string">    &#125;</span><br><span class="hljs-string">  ]</span><br><span class="hljs-string">&#125;</span><br></code></pre></td></tr></table></figure>

<h3 id="3、自定义词库"><a href="#3、自定义词库" class="headerlink" title="3、自定义词库"></a>3、自定义词库</h3><h4 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># 随便启动一个，为了复制出配置</span><br> lqs@PolarisiMac  ~/mydata  docker run -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> --name nginx -d nginx:<span class="hljs-number">1.10</span><br><span class="hljs-comment"># 把配置文件复制到mydata文件夹下</span><br> lqs@PolarisiMac  ~<span class="hljs-regexp">/mydata  docker container cp nginx:/</span>etc/nginx .<br><span class="hljs-comment"># 将nginx命名为conf，新建nginx文件夹，将conf移进nginx</span><br>└── nginx<br>    └── conf<br>        ├── conf.d<br>        │   └── default.conf<br>        ├── fastcgi_params<br>        ├── koi-utf<br>        ├── koi-win<br>        ├── mime.types<br>        ├── modules -&gt; <span class="hljs-regexp">/usr/</span>lib<span class="hljs-regexp">/nginx/m</span>odules<br>        ├── nginx.conf<br>        ├── scgi_params<br>        ├── uwsgi_params<br>        └── win-utf<br><span class="hljs-comment"># 创建新的nginx</span><br>docker run -p <span class="hljs-number">80</span>:<span class="hljs-number">80</span> --name nginx \<br>-v <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>nginx<span class="hljs-regexp">/html:/u</span>sr<span class="hljs-regexp">/share/</span>nginx/html \<br>-v <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>nginx<span class="hljs-regexp">/logs:/</span>var<span class="hljs-regexp">/log/</span>nginx \<br>-v <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/mydata/</span>nginx<span class="hljs-regexp">/conf:/</span>etc/nginx \<br>-d nginx:<span class="hljs-number">1.10</span><br></code></pre></td></tr></table></figure>

<h4 id="添加字典"><a href="#添加字典" class="headerlink" title="添加字典"></a>添加字典</h4><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">echo <span class="hljs-string">&quot;尚硅谷 乔碧罗&quot;</span> &gt; <span class="hljs-regexp">/mydata/</span>nginx<span class="hljs-regexp">/html/</span>fenci.txt<br></code></pre></td></tr></table></figure>

<h4 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs xml">vim $HOME/mydata/elasticsearch/plugins/ik/config/IKAnalyzer.cfg.xml<br><br><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">properties</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">&quot;http://java.sun.com/dtd/properties.dtd&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer 扩展配置<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span><br>	<span class="hljs-comment">&lt;!--用户可以在这里配置自己的扩展字典 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;ext_dict&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>	 <span class="hljs-comment">&lt;!--用户可以在这里配置自己的扩展停止词字典--&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;ext_stopwords&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>	<span class="hljs-comment">&lt;!--用户可以在这里配置远程扩展字典 --&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">&quot;remote_ext_dict&quot;</span>&gt;</span>http://#/es/fenci.txt<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span><br>	<span class="hljs-comment">&lt;!--用户可以在这里配置远程扩展停止词字典--&gt;</span><br>	<span class="hljs-comment">&lt;!-- &lt;entry key=&quot;remote_ext_stopwords&quot;&gt;words_location&lt;/entry&gt; --&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br></code></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><ul>
<li>先重启 es</li>
</ul>
<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FvVKkWUgdz03tRzLx1G3cXc-Pr7e.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="五、ElasticSearch-Rest-Client"><a href="#五、ElasticSearch-Rest-Client" class="headerlink" title="五、ElasticSearch-Rest-Client"></a>五、ElasticSearch-Rest-Client</h1><p>有几种办法</p>
<ol>
<li>9300: TCP</li>
</ol>
<ul>
<li>spring-data-elasticsearch:transport-api.jar;<ul>
<li>springboot 版本不同，ransport-api.jar 不同，不能适配 es 版本</li>
<li>7.x 已经不建议使用，8 以后就要废弃</li>
</ul>
</li>
</ul>
<ol start="2">
<li>9200: HTTP</li>
</ol>
<ul>
<li>jestClient: 非官方，更新慢；</li>
<li>RestTemplate：模拟 HTTP 请求，ES 很多操作需要自己封装，麻烦；</li>
<li>HttpClient：同上；</li>
<li>Elasticsearch-Rest-Client：官方 RestClient，封装了 ES 操作，API 层次分明，上手简单；<br>最终选择 Elasticsearch-Rest-Client（elasticsearch-rest-high-level-client）；<br><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html">https://www.elastic.co/guide/en/elasticsearch/client/java-rest/current/java-rest-high.html</a></li>
</ul>
<h2 id="1、SpringBoot-整合-ES"><a href="#1、SpringBoot-整合-ES" class="headerlink" title="1、SpringBoot 整合 ES"></a>1、SpringBoot 整合 ES</h2><ul>
<li>1、maven 依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>   <span class="hljs-tag">&lt;<span class="hljs-name">elasticsearch.version</span>&gt;</span>7.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">elasticsearch.version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-high-level-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;elasticsearch.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch.client<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch-rest-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;elasticsearch.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>elasticsearch<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;elasticsearch.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>2、yml 配置</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-comment"># 应用名称</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">gulimall-search</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">nacos:</span><br>      <span class="hljs-attr">discovery:</span><br>        <span class="hljs-attr">server-addr:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><span class="hljs-string">:8848</span><br>  <span class="hljs-attr">elasticsearch:</span><br>    <span class="hljs-attr">jest:</span><br>      <span class="hljs-attr">proxy:</span><br>        <span class="hljs-attr">port:</span> <span class="hljs-number">9200</span><br>        <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span><br>      <span class="hljs-attr">username:</span> <span class="hljs-string">elastic</span><br>      <span class="hljs-attr">password:</span> <span class="hljs-string">changme</span><br></code></pre></td></tr></table></figure>

<ul>
<li>3、配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//以后会修改</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GulimallElasticSearchConfig</span> &#123;<br><br>    <span class="hljs-comment">//通用设置项</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> RequestOptions COMMON_OPTIONS;<br>    <span class="hljs-keyword">static</span> &#123;<br>        RequestOptions.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> RequestOptions.DEFAULT.toBuilder();<br>        COMMON_OPTIONS = builder.build();<br>    &#125;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-keyword">public</span> RestHighLevelClient <span class="hljs-title function_">esRestClient</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">RestClientBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br><br>        builder = RestClient.builder(<span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHost</span>(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-number">9200</span>,<span class="hljs-string">&quot;http&quot;</span>));<br><br>        <span class="hljs-type">RestHighLevelClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestHighLevelClient</span>(builder);<br>        <span class="hljs-keyword">return</span> client;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>4、测试使用</li>
</ul>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><code class="hljs awk">@RunWith(SpringRunner.class)<br>@SpringBootTest<br>public class GulimallSearchApplicationTests &#123;<br><br>    @Resource<br>    private RestHighLevelClient client;<br><br>    @Data<br>    @AllArgsConstructor<br>    @NoArgsConstructor<br>    class User&#123;<br>        private String userName;<br>        private String gender;<br>        private Integer age;<br>    &#125;<br><br>    @Data<br>    @ToString<br>    @AllArgsConstructor<br>    @NoArgsConstructor<br>    static class Account&#123;<br>        private int account_number;<br>        private int balance;<br>        private String firstname;<br>        private String lastname;<br>        private int age;<br>        private String gender;<br>        private String address;<br>        private String employer;<br>        private String email;<br>        private String city;<br>        private String state;<br>    &#125;<br>    /**<br>     * 更新保存二合一<br>     * @throws IOException 网络操作必定需要处理异常<br>     */<br>    @Test<br>    public void contextLoads() throws IOException &#123;<br>        IndexRequest indexRequest = new IndexRequest(<span class="hljs-string">&quot;users&quot;</span>);<br>        indexRequest.id(<span class="hljs-string">&quot;1&quot;</span>);<br>        <span class="hljs-regexp">//</span>使用方法一<br><span class="hljs-regexp">//</span>        indexRequest.source(<span class="hljs-string">&quot;userName&quot;</span>,<span class="hljs-string">&quot;zhangsan&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>,<span class="hljs-number">18</span>,<span class="hljs-string">&quot;gender&quot;</span>,<span class="hljs-string">&quot;male&quot;</span>);<br>        <span class="hljs-regexp">//</span>使用方法二<br>        User user = new User(<span class="hljs-string">&quot;lqs&quot;</span>, <span class="hljs-string">&quot;male&quot;</span>, <span class="hljs-number">21</span>);<br>        String jsonString = JSON.toJSONString(user);<br>        indexRequest.source(jsonString, XContentType.JSON);<br><br>        <span class="hljs-regexp">//</span>执行操作<br>        IndexResponse index = client.index(indexRequest, GulimallElasticSearchConfig.COMMON_OPTIONS);<br><br>        <span class="hljs-regexp">//</span>提取响应数据<br>        System.out.println(index);<br>    &#125;<br><br>    @Test<br>    public void testSearch() throws IOException &#123;<br>        <span class="hljs-regexp">//</span><span class="hljs-number">1</span>、创建检索请求<br>        SearchRequest searchRequest = new SearchRequest();<br>        <span class="hljs-regexp">//</span>指定索引<br>        searchRequest.indices(<span class="hljs-string">&quot;bank&quot;</span>);<br>        <span class="hljs-regexp">//</span>指定DSL，检索条件<br>        SearchSourceBuilder sourceBuilder = new SearchSourceBuilder();<br>        searchRequest.source(sourceBuilder);<br>        <span class="hljs-regexp">//</span><span class="hljs-number">1</span>、<span class="hljs-number">1</span>构建检索条件<br>        sourceBuilder.query(QueryBuilders.matchQuery(<span class="hljs-string">&quot;address&quot;</span>,<span class="hljs-string">&quot;mill&quot;</span>));<br><span class="hljs-regexp">//</span>        System.out.println(sourceBuilder.toString());<br><span class="hljs-regexp">//</span>        sourceBuilder.from();<br><span class="hljs-regexp">//</span>        sourceBuilder.size();<br>        <span class="hljs-regexp">//</span><span class="hljs-number">1</span>、<span class="hljs-number">2</span>按照年龄聚合<br>        TermsAggregationBuilder ageAgg = AggregationBuilders.terms(<span class="hljs-string">&quot;ageAgg&quot;</span>).field(<span class="hljs-string">&quot;age&quot;</span>).size(<span class="hljs-number">10</span>);<br>        sourceBuilder.aggregation(ageAgg);<br>        <span class="hljs-regexp">//</span><span class="hljs-number">1</span>、<span class="hljs-number">3</span>计算平均薪资<br>        AvgAggregationBuilder balanceAvg = AggregationBuilders.avg(<span class="hljs-string">&quot;balanceAvg&quot;</span>).field(<span class="hljs-string">&quot;balance&quot;</span>);<br><span class="hljs-regexp">//</span>        System.out.println(<span class="hljs-string">&quot;检索条件&quot;</span>+sourceBuilder.toString());<br>        sourceBuilder.aggregation(balanceAvg);<br><br>        <span class="hljs-regexp">//</span><span class="hljs-number">2</span>、执行检索<br>        SearchResponse response = client.search(searchRequest, GulimallElasticSearchConfig.COMMON_OPTIONS);<br><br>        <span class="hljs-regexp">//</span><span class="hljs-number">3</span>、结果分析<br><span class="hljs-regexp">//</span>        System.out.println(response.toString());<br>        Map map = JSON.parseObject(response.toString(), Map.class);<br>        <span class="hljs-regexp">//</span>&#123;<span class="hljs-string">&quot;query&quot;</span>:&#123;<span class="hljs-string">&quot;match&quot;</span>:&#123;<span class="hljs-string">&quot;address&quot;</span>:&#123;<span class="hljs-string">&quot;query&quot;</span>:<span class="hljs-string">&quot;mill&quot;</span>,<span class="hljs-string">&quot;operator&quot;</span>:<span class="hljs-string">&quot;OR&quot;</span>,<span class="hljs-string">&quot;prefix_length&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;max_expansions&quot;</span>:<span class="hljs-number">50</span>,<span class="hljs-string">&quot;fuzzy_transpositions&quot;</span>:true,<span class="hljs-string">&quot;lenient&quot;</span>:false,<span class="hljs-string">&quot;zero_terms_query&quot;</span>:<span class="hljs-string">&quot;NONE&quot;</span>,<span class="hljs-string">&quot;auto_generate_synonyms_phrase_query&quot;</span>:true,<span class="hljs-string">&quot;boost&quot;</span>:<span class="hljs-number">1.0</span>&#125;&#125;&#125;&#125;<br>        <span class="hljs-regexp">//</span>&#123;<span class="hljs-string">&quot;took&quot;</span>:<span class="hljs-number">24</span>,<span class="hljs-string">&quot;timed_out&quot;</span>:false,<span class="hljs-string">&quot;_shards&quot;</span>:&#123;<span class="hljs-string">&quot;total&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;successful&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;skipped&quot;</span>:<span class="hljs-number">0</span>,<span class="hljs-string">&quot;failed&quot;</span>:<span class="hljs-number">0</span>&#125;,<span class="hljs-string">&quot;hits&quot;</span>:&#123;<span class="hljs-string">&quot;total&quot;</span>:&#123;<span class="hljs-string">&quot;value&quot;</span>:<span class="hljs-number">4</span>,<span class="hljs-string">&quot;relation&quot;</span>:<span class="hljs-string">&quot;eq&quot;</span>&#125;,<span class="hljs-string">&quot;max_score&quot;</span>:<span class="hljs-number">5.4032025</span>,<span class="hljs-string">&quot;hits&quot;</span>:[&#123;<span class="hljs-string">&quot;_index&quot;</span>:<span class="hljs-string">&quot;bank&quot;</span>,<span class="hljs-string">&quot;_type&quot;</span>:<span class="hljs-string">&quot;account&quot;</span>,<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;970&quot;</span>,<span class="hljs-string">&quot;_score&quot;</span>:<span class="hljs-number">5.4032025</span>,<span class="hljs-string">&quot;_source&quot;</span>:&#123;<span class="hljs-string">&quot;account_number&quot;</span>:<span class="hljs-number">970</span>,<span class="hljs-string">&quot;balance&quot;</span>:<span class="hljs-number">19648</span>,<span class="hljs-string">&quot;firstname&quot;</span>:<span class="hljs-string">&quot;Forbes&quot;</span>,<span class="hljs-string">&quot;lastname&quot;</span>:<span class="hljs-string">&quot;Wallace&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">28</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;990 Mill Road&quot;</span>,<span class="hljs-string">&quot;employer&quot;</span>:<span class="hljs-string">&quot;Pheast&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;forbeswallace@pheast.com&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;Lopezo&quot;</span>,<span class="hljs-string">&quot;state&quot;</span>:<span class="hljs-string">&quot;AK&quot;</span>&#125;&#125;,&#123;<span class="hljs-string">&quot;_index&quot;</span>:<span class="hljs-string">&quot;bank&quot;</span>,<span class="hljs-string">&quot;_type&quot;</span>:<span class="hljs-string">&quot;account&quot;</span>,<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;136&quot;</span>,<span class="hljs-string">&quot;_score&quot;</span>:<span class="hljs-number">5.4032025</span>,<span class="hljs-string">&quot;_source&quot;</span>:&#123;<span class="hljs-string">&quot;account_number&quot;</span>:<span class="hljs-number">136</span>,<span class="hljs-string">&quot;balance&quot;</span>:<span class="hljs-number">45801</span>,<span class="hljs-string">&quot;firstname&quot;</span>:<span class="hljs-string">&quot;Winnie&quot;</span>,<span class="hljs-string">&quot;lastname&quot;</span>:<span class="hljs-string">&quot;Holland&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">38</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;198 Mill Lane&quot;</span>,<span class="hljs-string">&quot;employer&quot;</span>:<span class="hljs-string">&quot;Neteria&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;winnieholland@neteria.com&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;Urie&quot;</span>,<span class="hljs-string">&quot;state&quot;</span>:<span class="hljs-string">&quot;IL&quot;</span>&#125;&#125;,&#123;<span class="hljs-string">&quot;_index&quot;</span>:<span class="hljs-string">&quot;bank&quot;</span>,<span class="hljs-string">&quot;_type&quot;</span>:<span class="hljs-string">&quot;account&quot;</span>,<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;345&quot;</span>,<span class="hljs-string">&quot;_score&quot;</span>:<span class="hljs-number">5.4032025</span>,<span class="hljs-string">&quot;_source&quot;</span>:&#123;<span class="hljs-string">&quot;account_number&quot;</span>:<span class="hljs-number">345</span>,<span class="hljs-string">&quot;balance&quot;</span>:<span class="hljs-number">9812</span>,<span class="hljs-string">&quot;firstname&quot;</span>:<span class="hljs-string">&quot;Parker&quot;</span>,<span class="hljs-string">&quot;lastname&quot;</span>:<span class="hljs-string">&quot;Hines&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">38</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;M&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;715 Mill Avenue&quot;</span>,<span class="hljs-string">&quot;employer&quot;</span>:<span class="hljs-string">&quot;Baluba&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;parkerhines@baluba.com&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;Blackgum&quot;</span>,<span class="hljs-string">&quot;state&quot;</span>:<span class="hljs-string">&quot;KY&quot;</span>&#125;&#125;,&#123;<span class="hljs-string">&quot;_index&quot;</span>:<span class="hljs-string">&quot;bank&quot;</span>,<span class="hljs-string">&quot;_type&quot;</span>:<span class="hljs-string">&quot;account&quot;</span>,<span class="hljs-string">&quot;_id&quot;</span>:<span class="hljs-string">&quot;472&quot;</span>,<span class="hljs-string">&quot;_score&quot;</span>:<span class="hljs-number">5.4032025</span>,<span class="hljs-string">&quot;_source&quot;</span>:&#123;<span class="hljs-string">&quot;account_number&quot;</span>:<span class="hljs-number">472</span>,<span class="hljs-string">&quot;balance&quot;</span>:<span class="hljs-number">25571</span>,<span class="hljs-string">&quot;firstname&quot;</span>:<span class="hljs-string">&quot;Lee&quot;</span>,<span class="hljs-string">&quot;lastname&quot;</span>:<span class="hljs-string">&quot;Long&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>:<span class="hljs-number">32</span>,<span class="hljs-string">&quot;gender&quot;</span>:<span class="hljs-string">&quot;F&quot;</span>,<span class="hljs-string">&quot;address&quot;</span>:<span class="hljs-string">&quot;288 Mill Street&quot;</span>,<span class="hljs-string">&quot;employer&quot;</span>:<span class="hljs-string">&quot;Comverges&quot;</span>,<span class="hljs-string">&quot;email&quot;</span>:<span class="hljs-string">&quot;leelong@comverges.com&quot;</span>,<span class="hljs-string">&quot;city&quot;</span>:<span class="hljs-string">&quot;Movico&quot;</span>,<span class="hljs-string">&quot;state&quot;</span>:<span class="hljs-string">&quot;MT&quot;</span>&#125;&#125;]&#125;&#125;<br>        <span class="hljs-regexp">//</span><span class="hljs-number">3</span>、<span class="hljs-number">1</span> 获取所有查到的数据<br>        SearchHits hits = response.getHits();<br>        SearchHit[] searchHits = hits.getHits();<br>        <span class="hljs-keyword">for</span> (SearchHit hit : searchHits)&#123;<br>            /*&#123;<br>                <span class="hljs-string">&quot;_index&quot;</span> : <span class="hljs-string">&quot;bank&quot;</span>,<br>                    <span class="hljs-string">&quot;_type&quot;</span> : <span class="hljs-string">&quot;account&quot;</span>,<br>                    <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-string">&quot;970&quot;</span>,<br>                    <span class="hljs-string">&quot;_score&quot;</span> : <span class="hljs-number">5.4032025</span>,<br>                    <span class="hljs-string">&quot;_source&quot;</span> : &#123;<br>                <span class="hljs-string">&quot;account_number&quot;</span> : <span class="hljs-number">970</span>,<br>                        <span class="hljs-string">&quot;balance&quot;</span> : <span class="hljs-number">19648</span>,<br>                         <span class="hljs-string">&quot;firstname&quot;</span> : <span class="hljs-string">&quot;Forbes&quot;</span>,<br>                        <span class="hljs-string">&quot;lastname&quot;</span> : <span class="hljs-string">&quot;Wallace&quot;</span>,<br>                        <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-number">28</span>,<br>                        <span class="hljs-string">&quot;gender&quot;</span> : <span class="hljs-string">&quot;M&quot;</span>,<br>                        <span class="hljs-string">&quot;address&quot;</span> : <span class="hljs-string">&quot;990 Mill Road&quot;</span>,<br>                        <span class="hljs-string">&quot;employer&quot;</span> : <span class="hljs-string">&quot;Pheast&quot;</span>,<br>                        <span class="hljs-string">&quot;email&quot;</span> : <span class="hljs-string">&quot;forbeswallace@pheast.com&quot;</span>,<br>                        <span class="hljs-string">&quot;city&quot;</span> : <span class="hljs-string">&quot;Lopezo&quot;</span>,<br>                        <span class="hljs-string">&quot;state&quot;</span> : <span class="hljs-string">&quot;AK&quot;</span><br>            &#125;<br>            &#125;*/<br><span class="hljs-regexp">//</span>            System.out.println(hit.toString());<br>            String str = hit.getSourceAsString();<br>            Account account = JSON.parseObject(str, Account.class);<br><span class="hljs-regexp">//</span>            System.out.println(<span class="hljs-string">&quot;account: &quot;</span>+account);<br>        &#125;<br>        <span class="hljs-regexp">//</span><span class="hljs-number">3</span>、<span class="hljs-number">2</span> 获取检索到的分析信息<br>        Aggregations aggregations = response.getAggregations();<br>        <span class="hljs-keyword">for</span>(Aggregation aggregation : aggregations.asList())&#123;<br><span class="hljs-regexp">//</span>            System.out.println(<span class="hljs-string">&quot;当前聚合&quot;</span>+aggregation.getName());<br>        &#125;<br><br>        Terms ageAgg1 = aggregations.get(<span class="hljs-string">&quot;ageAgg&quot;</span>);<br>        <span class="hljs-keyword">for</span> (Terms.Bucket bucket : ageAgg1.getBuckets())&#123;<br>            String keyAsString = bucket.getKeyAsString();<br>            System.out.println(<span class="hljs-string">&quot;年龄&quot;</span>+keyAsString);<br>        &#125;<br>        Avg balanceAvg1 =  aggregations.get(<span class="hljs-string">&quot;balanceAvg&quot;</span>);<br>        Aggregation balanceAvg2 = aggregations.get(<span class="hljs-string">&quot;balanceAvg&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://lqsgoodboy.oss-cn-shanghai.aliyuncs.com/yuque_hexo/FjtSEQKwQGe6RJD8-B0tAi5hfbpB.png" srcset="/img/loading.gif" lazyload></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/NoSQL/" class="category-chain-item">NoSQL</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/ES/">#ES</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>ElasticSearch</div>
      <div>https://polarisink.github.io/2022/08/13/yuque/ElasticSearch/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>Areis</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年8月13日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/08/13/yuque/Nginx/" title="Nginx">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Nginx</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/08/13/yuque/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="Java8新特性">
                        <span class="hidden-mobile">Java8新特性</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
